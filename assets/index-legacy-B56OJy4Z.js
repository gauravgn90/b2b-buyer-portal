System.register(["./mui-legacy-BDTphHaF.js","./reactVendor-legacy-CtYIj4Ma.js","./lang-legacy-C2M9M2Og.js","./react-setup-legacy-Bwwh9_Jr.js","./B3Filter-legacy-cLJO6KUk.js","../index-legacy.BPYbSXo1.js","./Edit-legacy-BuM8f0CG.js","./users-legacy-D6WYvWub.js","./form-legacy-CAo5v63e.js","./lodashEs-legacy-Da1qF4L1.js","./B3CustomForm-legacy-BVFdU8az.js","./b3Logger-legacy-C5y5ZQF8.js","./eStyled-legacy-D59194a7.js","./eReact-legacy-BRtOBtIF.js","./intl-legacy-DG3cM9-L.js","./eCache-legacy-BoIqTPuc.js","./redux-legacy-Dls004SH.js","./toolkit-legacy-6OFItfV5.js","./router-legacy-CCJEjNy7.js","./muiIcon-legacy-BXgwC5sb.js","./dateFns-legacy-DV9BM4UY.js","./dropzone-legacy-B_7NAEdu.js","./B3FilterMore-legacy-CFk9nW9w.js","./B3FilterSearch-legacy-DYz9XuR_.js"],(function(e,a){"use strict";var l,t,n,s,r,i,o,d,c,u,m,f,y,g,p,x,h,b,j,C,N,R,S,I,E,B,M,F,k,v,w,T,V,A;return{setters:[e=>{l=e.j,t=e.J,n=e.ab,s=e.T,r=e.B,i=e.I},e=>{o=e.r},e=>{d=e.u},e=>{c=e.u,u=e._,m=e.aA,f=e.a5,y=e.a6,g=e.aa,p=e.a9,x=e.a,h=e.ab,b=e.R,j=e.a2,C=e.ac},e=>{N=e.B},null,e=>{R=e.d,S=e.u,I=e.a},e=>{E=e.g,B=e.b,M=e.a,F=e.d,k=e.e},e=>{v=e.u},e=>{w=e.f},e=>{T=e.B},e=>{V=e.b},e=>{A=e.n},null,null,null,null,null,null,null,null,null,null,null],execute:function(){e("default",(function(){const[e,a]=o.useState(!1),[t,n]=o.useState(!1),[s,i]=o.useState({createdAt:0,email:"",firstName:"",id:"",lastName:"",phone:"",role:0,updatedAt:0,extraFields:[],companyRoleName:"",companyRoleId:""}),m=d(),[y]=x(),g=S(),p=c((({b2bFeatures:e})=>e.masqueradeCompany.id)),R=c((({company:e})=>e.customer.role)),E=c((({company:e})=>e.companyInfo)),B=+R===h.SUPER_ADMIN?p:E?.id,M=c(b).userActionsPermission,v=o.useRef(null),[w]=I(),T={isEnabled:M,customLabel:m("userManagement.addUser")},V={search:"",companyRoleId:"",companyId:B},A=L(m),[z,U]=o.useState(V),[D,O]=o.useState(A),[P,J]=o.useState(""),H=()=>{w.current?.refresh()},X=e=>{v.current?.handleOpenAddEditUserClick("edit",e)},$=e=>{i(e),n(!0)},Y=()=>{n(!1)};return o.useEffect((()=>{(()=>{const e=A.map((e=>{const a=e,l=e.options?.map((e=>(e.label=m(e.idLang),e)));return a.options=l,a.setValueName=J,a.default=z.companyRoleId,a.defaultName=z.companyRoleId?P:"",e}));O(e)})()}),[z,z.companyRoleId]),l.jsx(j,{isSpinning:e,children:l.jsxs(r,{sx:{display:"flex",flexDirection:"column",flex:1},children:[l.jsx(N,{fiterMoreInfo:D,handleChange:(e,a)=>{const l={...z,q:a};U(l)},handleFilterChange:e=>{const a={...z,companyRoleId:e.companyRoleId,offset:0};U(a)},customButtomConfig:T,handleFilterCustomButtomClick:()=>{v.current?.handleOpenAddEditUserClick("add")},resetFilterInfo:()=>{const e=D.map((e=>{const a=e;return a.setValueName=J,a.defaultName="",e}));J(""),O(e)}}),l.jsx(C,{ref:w,columnItems:[],rowsPerPageOptions:[12,24,36],getRequestList:async e=>{const a=await F(e),{users:{edges:l,totalCount:t}}=a;return{edges:l,totalCount:t}},searchParams:z||{},isCustomRender:!0,itemXs:g?3:4,requestLoading:a,renderItem:e=>l.jsx(_,{item:e,isPermissions:M,onEdit:X,onDelete:$},e.id||"")}),l.jsx(q,{companyId:B,renderList:H,ref:v}),l.jsx(u,{isOpen:t,title:m("userManagement.deleteUser"),leftSizeBtn:m("userManagement.cancel"),rightSizeBtn:m("userManagement.delete"),handleLeftClick:Y,handRightClick:async e=>{if(e)try{a(!0),Y(),await k({userId:e.id||"",companyId:B}),f.success(m("userManagement.deleteUserSuccessfully"))}finally{a(!1),H()}},row:s,rightStyleBtn:{color:"#D32F2F"},isShowBordered:!1,children:l.jsx(r,{sx:{display:"flex",justifyContent:y?"center%":"start",width:y?"100%":"450px",height:"100%"},children:m("userManagement.confirmDelete")})})]})})}));const a=()=>[{label:"Admin",name:"Admin",value:0,idLang:"userManagement.userRole.admin"},{label:"Senior buyer",name:"Senior Buyer",value:1,idLang:"userManagement.userRole.seniorBuyer"},{label:"Junior buyer",name:"Junior Buyer",value:2,idLang:"userManagement.userRole.juniorBuyer"}],L=e=>[{name:"companyRoleId",label:e("userManagement.config.userRole"),required:!1,default:"",defaultName:"",fieldType:"roleAutocomplete",xs:12,disabled:!1,variant:"filled",size:"small"}],z={3:"global.emailValidate.multipleCustomer",4:"global.emailValidate.companyUsed",5:"global.emailValidate.alreadyExits",6:"global.emailValidate.usedSuperAdmin"},U={0:"text",1:"multiline",2:"number",3:"dropdown"},D=async()=>{let e=[];try{const{userExtraFields:a}=await E();e=(e=>e.map((e=>{const{listOfValue:a}=e,l=U[e.fieldType],t={isExtraFields:!0,name:e.fieldName,label:e.labelName,required:e.isRequired,default:e.defaultValue||"",fieldType:l,xs:12,variant:"filled",size:"small"};switch(l){case"dropdown":if(a){const e=a?.map((e=>({label:e,value:e})));e.length>0&&(t.options=e)}break;case"number":t.max=e.maximumValue||"";break;case"mutiline":t.rows=e.numberOfRows||"";break;default:t.maxLength=e.maximumLength||""}return t})))(a.filter((e=>e.visibleToEnduser)))}catch(a){V.error(a)}return e},q=o.forwardRef((function({companyId:e,renderList:a},t){const n=c((({company:e})=>e.customer.b2bId)),[s,r]=o.useState(!1),[i,g]=o.useState(""),[p,x]=o.useState(null),[h,b]=o.useState(!1),[j,C]=o.useState([]),[N,R]=o.useState([]),S=d(),{control:I,handleSubmit:E,getValues:F,formState:{errors:k},clearErrors:V,setValue:A,setError:U}=v({mode:"onSubmit"});o.useEffect((()=>{0===N.length&&(async()=>{const e=await D();R(e)})()}),[N.length]),o.useEffect((()=>{if(s){const e=j.map((e=>{const a=e;return"edit"===i&&p&&A(e.name,p[e.name]),a}));C(e)}}),[p,s,i]);const q=()=>{j.forEach((e=>{A(e.name,""),e.isExtraFields&&A(e.name,e.default||"")})),V(),r(!1)},O=(e,a)=>{const l=((e,a,l=!1)=>{const t=L(a);return t[0].required=!0,t[0].disabled=l,[...t,{name:"email",label:a("userManagement.config.email"),required:!0,fieldType:"text",xs:12,disabled:"edit"===e,default:"",variant:"filled",size:"small"},{name:"firstName",label:a("userManagement.config.firstName"),required:!0,default:"",fieldType:"text",xs:6,variant:"filled",size:"small"},{name:"lastName",label:a("userManagement.config.lastName"),required:!0,fieldType:"text",xs:6,default:"",variant:"filled",size:"small"},{name:"phone",label:a("userManagement.config.phoneNumber"),required:!1,fieldType:"text",xs:12,default:"",variant:"filled",size:"small"}]})(e,S,"edit"===e&&n===+a.id);if("edit"===e){const e=a.extraFields||[];let t=a;if(e&&e.length>0){const l={};e.forEach((e=>{l[e.fieldName]=e.fieldValue})),t={...a,...l}}x(t);const n=l.find((e=>"companyRoleId"===e.name))||null;n&&(n.defaultName=a?.companyRoleName||"",n.default=a?.companyRoleId||"")}const t=w(l,N);C(t),g(e),r(!0)};return o.useImperativeHandle(t,(()=>({handleOpenAddEditUserClick:O}))),l.jsx(u,{isOpen:s,title:`${S("edit"===i?"userManagement.editUser":"userManagement.addNewUser")}`,leftSizeBtn:S("userManagement.cancel"),rightSizeBtn:S("userManagement.saveUser"),handleLeftClick:q,handRightClick:()=>{E((async l=>{b(!0);const t=(e=>{const a=Object.keys(e),l=[];return N.forEach((t=>{if(a.includes(t.name)){const a={fieldName:t.name||"",fieldValue:e[t.name]||""};l.push(a)}})),l})(l);let n=S("userManagement.addUserSuccessfully");try{const s={companyId:e,companyRoleId:+l.companyRoleId,...l,extraFields:t};if("edit"!==i){const{isValid:a,userType:t}=await(async a=>{const{userType:l,userInfo:{companyName:t}}=await M({email:a,companyId:e,channelId:y}),n=[m.DOESNT_EXIST,m.B2C,m.CURRENT_B2B_COMPANY_DIFFERENT_CHANNEL].includes(l);return n||U("email",{type:"custom",message:S(z[l],{companyName:t?`(${t})`:"",email:a})}),{isValid:n,userType:l}})(l.email);if(!a)return void b(!1);t===m.CURRENT_B2B_COMPANY_DIFFERENT_CHANNEL&&(s.addChannel=!0,n=S("userManagement.userDetected",{email:l.email}))}"edit"===i&&(s.userId=p?.id||"",n=S("userManagement.updateUserSuccessfully"),delete s.email),await B(s),q(),f.success(n),a()}finally{b(!1)}}))()},loading:h,isShowBordered:!0,children:l.jsx(T,{formFields:j,errors:k,control:I,getValues:F,setValue:A})})})),O=A("div")((()=>({display:"flex",alignItems:"center",justifyContent:"space-between"})));function _(e){const{item:o,onEdit:d,onDelete:c,isPermissions:u}=e;return l.jsx(t,{children:l.jsxs(n,{sx:{color:"#313440"},children:[l.jsxs(s,{variant:"h5",sx:{color:"rgba(0, 0, 0, 0.87)"},children:[o.firstName," ",o.lastName]}),l.jsx(s,{sx:{p:"15px 0"},variant:"body1",children:o.email}),l.jsxs(O,{children:[(e=>{const t=a().map((e=>2==+e.value?"Junior Buyer"!==o.companyRoleName?{color:"#ce93d8",textColor:"black",...e,label:o.companyRoleName,name:o.companyRoleName}:{color:"#D9DCE9",textColor:"black",...e}:1==+e.value?{color:"rgba(237, 108, 2, 0.3)",textColor:"black",...e}:{color:"#C4DD6C",textColor:"black",...e})).find((a=>a.name===e));return t?l.jsx(p,{color:t.color,textColor:t.textColor,children:t.label}):null})(o.companyRoleName),l.jsxs(r,{sx:{display:u?"block":"none"},children:[l.jsx(i,{"aria-label":"edit",size:"small",sx:{marginRight:"8px"},onClick:()=>{d(o)},children:l.jsx(R,{fontSize:"inherit"})}),l.jsx(i,{"aria-label":"delete",size:"small",onClick:()=>{c(o)},children:l.jsx(g,{fontSize:"inherit"})})]})]})]})},o.id)}}}}));
