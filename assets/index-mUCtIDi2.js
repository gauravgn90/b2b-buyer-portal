import{s as Be,j as s,v as ae,w as ie,x as Ae,J as De,ab as Se,T as _,B as K,I as pe,ac as be}from"./mui-5MYSBV5R.js";import{r as f}from"./reactVendor-BAhb8EbJ.js";import{u as X}from"./lang-BFcXlKUT.js";import{B as Fe}from"./B3Filter-B8HZ1N9c.js";import{B as je,a7 as Ee,a8 as Le,_ as me,a5 as w,a9 as ge,a3 as Ie,aa as we,a as he,a4 as ke,u as M,p as ve,G as Ne,R as Re,ab as ue,a2 as Te,ac as Oe,ad as Pe}from"./react-setup-B89zJiq4.js";import"../index.CgW3dhwJ.js";import{d as $e,u as ze,a as Ue}from"./Edit-71tYTg2e.js";import{b as W}from"./b3Logger-CMQiGC3f.js";import{c as _e,u as xe,a as Ve,b as qe,d as Me,e as Ge,g as Je,f as He,h as Ke,i as We}from"./address-ChPJPEAK.js";import{u as Xe}from"./form-Bvi8lP6x.js";import{c as Qe}from"./lodashEs-Ck10JMnh.js";import{B as Ye}from"./B3CustomForm-DjrjSYXN.js";import{d as te,g as ye}from"./config-DywBMq9e.js";import{b as Ze,a as es,f as ss,c as ts}from"./config-D455xR1G.js";import{n as Ce}from"./eStyled-BQSmO2oX.js";import"./eReact-DeS39u1B.js";import"./intl-CIPMD0ue.js";import"./eCache-BQInSoPa.js";import"./B3FilterMore-D4S_BlgN.js";import"./dateFns-CE3kB2v1.js";import"./B3FilterSearch-zd7_SPrR.js";import"./redux-B-shcavw.js";import"./toolkit-CHPG993j.js";import"./router-BbCjXwHs.js";import"./muiIcon-Du0m7JKT.js";import"./dropzone-CHkuoC7V.js";import"./validatorRules-CTaxO-S2.js";const as=d=>je.post("/api/v2/extra-fields/address/validate",Ee.B2BRest,{...d,storeHash:Le}),is=Be("div")(()=>({display:"flex","& div::first-of-type":{marginRight:"2rem"},"& div":{minWidth:"45%",display:"flex",flexDirection:"column"}}));function ns({addressFields:d,updateAddressList:t,companyId:p,isBCPermission:c,countries:o},j){const y=X(),[A,g]=f.useState(!1),[h,T]=f.useState(""),[k,v]=f.useState(!1),[D,V]=f.useState(d),[N,R]=f.useState([]),[O,G]=f.useState([]),[E,q]=f.useState(null),[F,S]=f.useState({isShipping:!1,isBilling:!1,isDefaultShipping:!1,isDefaultBilling:!1}),$=!c,{control:ne,handleSubmit:Q,getValues:J,formState:{errors:z},watch:H,setError:de,setValue:L,reset:Y}=Xe({mode:"all"}),Z=async u=>{var r;try{const e=N.map(i=>({fieldName:te(i.name),fieldValue:u[i.name]||i.default})),a=await as({extraFields:e});if(a.code!==200){const i=((r=a.data)==null?void 0:r.errMsg)||a.message||"",n=i.split(":");if(n.length>=2){const m=N.find(B=>te(B.name)===n[0]);if(m)return de(m.name,{type:"manual",message:n[1]}),v(!1),!1}throw i}return!0}catch(e){throw w.error(e),e}},ee=()=>{Y(),S({isShipping:!1,isBilling:!1,isDefaultShipping:!1,isDefaultBilling:!1}),g(!1),T("")},se=()=>{Q(async u=>{v(!0);try{if(!await Z(u))return;const e=N.map(I=>({fieldName:te(I.name),fieldValue:u[I.name]||I.default})),{country:a,state:i}=u;let n="",m="",B=i;o.forEach(I=>{const{countryName:U,countryCode:l,states:C}=I;if(l===a)if(n=U,C.length>0){const b=C.find(P=>P.stateCode===B||P.stateName===B);m=(b==null?void 0:b.stateName)||m,B=(b==null?void 0:b.stateCode)||B}else B="",m=i});const x={...u,companyId:+p,extraFields:e,isShipping:F.isShipping?1:0,isBilling:F.isBilling?1:0,isDefaultShipping:F.isDefaultShipping?1:0,isDefaultBilling:F.isDefaultBilling?1:0,country:n,countryCode:a,state:m,stateCode:B};if(h==="add")await _e(x),w.success(y("addresses.addressForm.newAddressAdded"));else if(h==="edit"&&E){const{id:I}=E;await xe({...x,id:+I}),w.success(y("addresses.addressForm.addressUpdated"))}S({isShipping:!1,isBilling:!1,isDefaultShipping:!1,isDefaultBilling:!1}),g(!1),await t(!0)}catch(r){w.error(r)}finally{v(!1)}})()},re=()=>{Q(async u=>{v(!0);try{const r=N.map(x=>({name:x.bcLabel,value:u[x.name]||x.default})),{country:e,state:a}=u;let i="",n="",m=a;o.forEach(x=>{const{countryName:I,countryCode:U,states:l}=x;if(U===e)if(i=I,l.length>0){const C=l.find(b=>b.stateCode===m||b.stateName===m);n=(C==null?void 0:C.stateName)||n,m=(C==null?void 0:C.stateCode)||m}else m="",n=a});const B={...u,formFields:r,country:i,countryCode:e,state:n,stateCode:m,addressType:""};if(h==="add")await Ve(B),w.success(y("addresses.addressForm.newAddressAdded"));else if(h==="edit"&&E){const{bcAddressId:x}=E;x&&await qe({...B,id:+x}),w.success(y("addresses.addressForm.addressUpdated"))}g(!1),await t(!0)}catch(r){w.error(r)}finally{v(!1)}})()},le=()=>{$?se():re()},oe=(u,r)=>{u==="add"&&O.length>0&&D.forEach(e=>{const a=e;if(e.custom)if($){const i=O.filter(n=>n.name===e.name)[0];a.default=i.default||""}else{const i=O.filter(n=>n.name===e.name||n.bcLabel===e.bcLabel)[0];a.default=i.default||""}}),Y(),q(r),T(u),g(!0)};f.useImperativeHandle(j,()=>({handleOpenAddEditAddressClick:oe}));const ce=(u,r)=>{S(r==="isShipping"?{...F,[r]:u,isDefaultShipping:!1}:{...F,[r]:u,isDefaultBilling:!1})};return f.useEffect(()=>{const u=JSON.parse(JSON.stringify(d));u.forEach(e=>{const a=e;return a.label=y(e.idLang)||e.label,!$&&e.fieldId==="field_21"&&(a.default=""),e}),V(u);const r=d.filter(e=>e.custom);if(R(r),O.length===0){const e=Qe(d);G(e)}},[d,O.length,$]),f.useEffect(()=>{A&&h==="edit"&&E&&(()=>{if(E){const{isShipping:r,isBilling:e,isDefaultShipping:a,isDefaultBilling:i,state:n,stateCode:m,countryCode:B,extraFields:x}=E,I=o.filter(U=>U.countryCode===B);S({isShipping:r===1,isBilling:e===1,isDefaultShipping:a===1,isDefaultBilling:i===1}),D.forEach(U=>{const l=U;if(l.custom&&x.length>0)if($){const C=te(l.name),b=x.find(fe=>fe.fieldName===C),P=O.find(fe=>fe.name===C);b?(L(l.name,b.fieldValue||""),l.default=b.fieldValue||""):(L(l.name,""),l.default=P.default)}else{const C=x.find(P=>P.fieldName===l.name||P.fieldName===l.bcLabel),b=O.filter(P=>P.name===l.name||P.bcLabel===l.bcLabel)[0];C?(L(l.name,C.fieldValue||""),l.default=C.fieldValue||b.default):(L(l.name,""),l.default=b.default)}else if(l.name==="country")L(l.name,B);else if(l.name==="state"){if(L(l.name,m||n),I[0]){const{states:C}=I[0];C.length>0?(l.options=C,l.fieldType="dropdown"):(l.options=[],l.fieldType="text")}}else L(l.name,E[l.name]==="undefined"?"":E[l.name])})}})()},[E,D,o,$,A,O,L,h]),f.useEffect(()=>{const u=e=>{var n;const a=((n=o.find(m=>m.countryCode===e))==null?void 0:n.states)||[],i=D.find(m=>m.name==="state");i&&(a.length>0?(i.fieldType="dropdown",i.options=a):(i.fieldType="text",i.options=[])),L("state",""),V([...D])},r=H((e,{name:a,type:i})=>{const{country:n}=e;a==="country"&&i==="change"&&u(n)});return()=>r.unsubscribe()},[D,o,H]),s.jsxs(me,{isOpen:A,title:y(h==="add"?"addresses.addressForm.addNewAddress":"addresses.addressForm.editAddress"),leftSizeBtn:y("addresses.addressForm.cancel"),rightSizeBtn:y("addresses.addressForm.saveAddress"),handleLeftClick:ee,handRightClick:le,loading:k,isShowBordered:!0,children:[$&&s.jsxs(s.Fragment,{children:[s.jsx("p",{children:y("addresses.addressForm.selectAddressType")}),s.jsx(is,{children:Ze.map(u=>{const{child:r,name:e,idLang:a}=u;return s.jsxs("div",{children:[s.jsx(ae,{control:s.jsx(ie,{checked:F[e],onChange:i=>{ce(i.target.checked,e)}}),label:y(a)}),r&&s.jsx(ae,{control:s.jsx(ie,{checked:F[r.name],onChange:()=>{S({...F,[r.name]:!F[r.name]})}}),label:y(r.idLang),sx:{display:F[e]?"":"none"}})]},e)})})]}),s.jsx(Ye,{formFields:D,errors:z,control:ne,getValues:J,setValue:L})]})}const ds=f.forwardRef(ns),rs=Ce("div")(({marginBottom:d})=>({marginBottom:d,"& > span:not(:last-child)":{marginRight:"4px"}})),ls=Ce("div")(({theme:d})=>({display:"flex",alignItems:"center",justifyContent:"space-between",marginTop:d.spacing(3)}));function os(d){const{item:t,onEdit:p,onDelete:c,onSetDefault:o,editPermission:j,isBCPermission:y}=d,A=Ae(),g=X();return s.jsx(De,{children:s.jsxs(Se,{sx:{color:"#313440",wordBreak:"break-word"},children:[t.label&&s.jsx(_,{variant:"h5",sx:{marginBottom:t.isDefaultShipping===1||t.isDefaultBilling===1?A.spacing(1):A.spacing(3),color:"rgba(0, 0, 0, 0.87)"},children:t.label}),s.jsxs(rs,{marginBottom:t.isDefaultShipping===1||t.isDefaultBilling===1?A.spacing(3):0,children:[t.isDefaultShipping===1&&s.jsx(ge,{color:"#C4DD6C",textColor:"rgba(0, 0, 0, 0.87)",children:g("addresses.addressItemCard.defaultShipping")}),t.isDefaultBilling===1&&s.jsx(ge,{color:"#C4DD6C",textColor:"rgba(0, 0, 0, 0.87)",children:g("addresses.addressItemCard.defaultBilling")})]}),s.jsx(_,{variant:"body1",children:"".concat(t.firstName," ").concat(t.lastName)}),s.jsx(_,{variant:"body1",children:t.company||""}),s.jsx(_,{variant:"body1",children:t.addressLine1}),s.jsx(_,{variant:"body1",children:t.addressLine2==="undefined"?"":t.addressLine2}),s.jsx(_,{variant:"body1",children:"".concat(t.city,", ").concat(t.state," ").concat(t.zipCode,", ").concat(t.country)}),s.jsx(_,{variant:"body1",children:t.phoneNumber}),j&&s.jsxs(ls,{children:[!y&&s.jsx(Ie,{variant:"text",sx:{ml:"-8px"},onClick:()=>{o(t)},children:g("addresses.addressItemCard.setAsDefault")}),s.jsxs(K,{sx:{flex:1,display:"flex",justifyContent:"flex-end"},children:[s.jsx(pe,{"aria-label":"edit",size:"small",sx:{marginRight:"8px"},onClick:()=>{p(t)},children:s.jsx($e,{fontSize:"inherit"})}),s.jsx(pe,{"aria-label":"delete",size:"small",onClick:()=>{c(t)},children:s.jsx(we,{fontSize:"inherit"})})]})]})]})},t.id)}function cs(d){const{isOpen:t,setIsOpen:p,addressData:c,updateAddressList:o,setIsLoading:j,companyId:y,isBCPermission:A}=d,[g]=he(),h=X(),T=async()=>{if(c)try{j(!0),p(!1);const{id:k="",bcAddressId:v=""}=c;A?await Ge({bcAddressId:v}):await Me({addressId:k,companyId:y}),w.success(h("addresses.deleteAddressDialog.successfullyDeleted")),o()}catch(k){j(!1)}};return s.jsx(me,{isOpen:t,title:h("addresses.deleteAddressDialog.deleteAddress"),leftSizeBtn:h("addresses.deleteAddressDialog.cancel"),rightSizeBtn:h("addresses.deleteAddressDialog.delete"),handleLeftClick:()=>{p(!1)},handRightClick:T,rightStyleBtn:{color:"#D32F2F"},isShowBordered:!1,children:s.jsx(K,{sx:{display:"flex",alignItems:"".concat(g?"start":"center"),justifyContent:"".concat(g?"center":"start"),width:"".concat(g?"100%":"450px"),height:"100%"},children:h("addresses.deleteAddressDialog.confirmDelete")})})}function fs(d){const{isOpen:t,setIsOpen:p,setIsLoading:c,addressData:o,updateAddressList:j,companyId:y}=d,[A]=he(),g=X(),[h,T]=f.useState();f.useEffect(()=>{T(o)},[o]);const k=D=>V=>{const{checked:N}=V.target;if(h){const R={...h};D==="isDefaultShipping"&&(R.isDefaultShipping=N?1:0,R.isShipping=N?1:R.isShipping),D==="isDefaultBilling"&&(R.isDefaultBilling=N?1:0,R.isBilling=N?1:R.isShipping),T(R)}},v=async()=>{try{c(!0),p(!1),await xe({...h,companyId:y}),w.success(g("addresses.setDefaultDialog.successfullySet")),j()}catch(D){c(!1)}};return s.jsx(me,{isOpen:t,title:g("addresses.setDefaultDialog.setDefaultAddress"),leftSizeBtn:g("addresses.setDefaultDialog.cancel"),rightSizeBtn:"set",handleLeftClick:()=>{p(!1)},handRightClick:v,children:s.jsx(K,{sx:{display:"flex",alignItems:"".concat(A?"start":"center"),justifyContent:"".concat(A?"center%":"start"),width:"".concat(A?"100%":"450px"),height:"100%"},children:h&&s.jsx(K,{sx:{padding:A?"0":"10px 0"},children:s.jsxs(be,{children:[s.jsx(ae,{control:s.jsx(ie,{checked:h.isDefaultShipping===1,onChange:k("isDefaultShipping")}),label:g("addresses.setDefaultDialog.setDefaultShippingAddress")}),s.jsx(ae,{control:s.jsx(ie,{checked:h.isDefaultBilling===1,onChange:k("isDefaultBilling")}),label:g("addresses.setDefaultDialog.setDefaultBillingAddress")})]})})})})}const us=d=>{if(d.length===0)return[];const t=d.filter(o=>o.visibleToEnduser)||[];if((t==null?void 0:t.length)===0)return[];const p=t.map(o=>({...o,groupId:4,visible:o.visibleToEnduser})),c=ye(p).address;return c.map(o=>{const j=o;return j.custom=!0,o}),c},ms=async()=>{try{const{accountFormFields:d}=await ke(1),t=d.filter(c=>c.groupId===4);return ye(t).address}catch(d){W.error(d)}},ps=async()=>{try{const d=await Je(),t=us(d.addressExtraFields);return[...es,...t]}catch(d){W.error(d)}return[]},gs=async(d,t)=>{let p=[];try{if(d){const c=await ps();c&&(p=c)}else p=await ms();return p.map(c=>{const o=c;return c.name==="country"&&(o.options=t),c.name==="state"&&(o.fieldType="text"),c}),p}catch(c){W.error(c)}return[]};function qs(){const d=M(ve),t=M(({company:e})=>e.companyInfo.id),p=M(({company:e})=>e.customer.role),c=M(({b2bFeatures:e})=>e.masqueradeCompany.id),o=M(({b2bFeatures:e})=>e.masqueradeCompany.isAgenting),{state:{addressConfig:j},dispatch:y}=f.useContext(Ne),{addressesActionsPermission:A}=M(Re),g=X(),h=ze(),[T]=Ue(),k=f.useRef(null),[v,D]=f.useState(!1),[V,N]=f.useState([]),[R,O]=f.useState([]),[G,E]=f.useState({search:""}),q=p===ue.SUPER_ADMIN&&o?c:t;let F=!1,S=!1;d&&(!p||p===ue.SUPER_ADMIN&&o)&&(F=!0),(!d||p===ue.SUPER_ADMIN&&!o)&&(S=!0),f.useEffect(()=>{(async()=>{const{countries:a}=await Pe();O(a),D(!0);try{const i=await gs(!S,a);N(i||[])}catch(i){W.error(i)}finally{D(!1)}})()},[]);const $=async(e={})=>{let a=[],i=0;if(S){const{customerAddresses:{edges:n=[],totalCount:m}}=await Ke({...e});a=n.map(B=>({node:ts(B.node)})),i=m}else{const{addresses:{edges:n=[],totalCount:m}}=await He({companyId:q,...e});a=n,i=m}return{edges:a,totalCount:i}},ne=(e,a)=>{e==="search"&&E({...G,search:a})},Q=e=>{E({...G,country:e.country||"",state:e.state||"",city:e.city||""})},J=()=>{var e;(e=T.current)==null||e.refresh()},[z,H]=f.useState(d?A:!1),[de,L]=f.useState(!1),[Y,Z]=f.useState(!1),[ee,se]=f.useState();f.useEffect(()=>{(async()=>{var a,i;if(S){H(!0);return}if(F)try{let n=j;if(!n){const{addressConfig:x}=await We();n=x,y({type:"common",payload:{addressConfig:n}})}const m=p===3?"address_sales_rep":"address_admin",B=((a=(n||[]).find(x=>x.key==="address_book"))==null?void 0:a.isEnabled)==="1"&&((i=(n||[]).find(x=>x.key===m))==null?void 0:i.isEnabled)==="1"&&A;H(B)}catch(n){W.error(n)}})()},[j,F,S,p]);const re=()=>{var e;if(!z){w.error(g("addresses.noPermissionToAdd"));return}(e=k.current)==null||e.handleOpenAddEditAddressClick("add")},le=e=>{var a;if(!z){w.error(g("addresses.noPermissionToEdit"));return}(a=k.current)==null||a.handleOpenAddEditAddressClick("edit",e)},oe=e=>{if(!z){w.error(g("addresses.noPermissionToEdit"));return}se({...e}),Z(!0)},ce=e=>{se({...e}),L(!0)},u={isEnabled:z,customLabel:g("addresses.addNewAddress")},r=JSON.parse(JSON.stringify(ss));return r.map(e=>{const a=e;return a.label=g(e.idLang),e}),s.jsx(Te,{isSpinning:v,children:s.jsxs(K,{sx:{display:"flex",flexDirection:"column",flex:1},children:[s.jsx(Fe,{fiterMoreInfo:r,handleChange:ne,handleFilterChange:Q,customButtomConfig:u,handleFilterCustomButtomClick:re}),s.jsx(Oe,{ref:T,columnItems:[],rowsPerPageOptions:[12,24,36],getRequestList:$,searchParams:G,isCustomRender:!0,itemXs:h?3:4,requestLoading:D,tableKey:"id",renderItem:e=>s.jsx(os,{item:e,onEdit:()=>le(e),onDelete:oe,onSetDefault:ce,editPermission:z,isBCPermission:S},e.id)}),s.jsx(ds,{updateAddressList:J,addressFields:V,ref:k,companyId:q,isBCPermission:S,countries:R}),z&&!S&&s.jsx(fs,{isOpen:de,setIsOpen:L,setIsLoading:D,addressData:ee,updateAddressList:J,companyId:q}),z&&s.jsx(cs,{isOpen:Y,setIsOpen:Z,setIsLoading:D,addressData:ee,updateAddressList:J,companyId:q,isBCPermission:S})]})})}export{qs as default};
