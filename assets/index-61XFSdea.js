import{j as c,B,a3 as he,$ as ge}from"./mui-5MYSBV5R.js";import{r as b}from"./reactVendor-BAhb8EbJ.js";import{u as xe}from"./form-Bvi8lP6x.js";import{u as be}from"./lang-BFcXlKUT.js";import{n as ye}from"./eStyled-BQSmO2oX.js";import{i as Fe}from"./lodashEs-Ck10JMnh.js";import{B as Ce}from"./B3Card-DexeMvwR.js";import{B as T}from"./B3CustomForm-DjrjSYXN.js";import{a as Be,G as we,u as Ee,bs as Le,C as Se,k as je,a2 as Ae,a3 as Ie,a4 as Re,ad as Te,x as ve,bo as Ne,a6 as Me,bt as Ve,a8 as ke}from"./react-setup-B89zJiq4.js";import"../index.CgW3dhwJ.js";import{b as S}from"./b3Logger-CMQiGC3f.js";import{l as Ue}from"./b3Login-1VB9S_e7.js";import{d as qe,e as De,b as ze,f as Pe,T as He,I as v,a as Oe,v as _e}from"./RegisteredFinish-CEwyDIot.js";import{s as $e,b as Ge,g as We,d as y,t as Je,B as Ke}from"./config-DywBMq9e.js";import{u as Qe}from"./router-BbCjXwHs.js";import"./eReact-DeS39u1B.js";import"./intl-CIPMD0ue.js";import"./eCache-BQInSoPa.js";import"./redux-B-shcavw.js";import"./toolkit-CHPG993j.js";import"./muiIcon-Du0m7JKT.js";import"./dateFns-CE3kB2v1.js";import"./dropzone-CHkuoC7V.js";import"./validatorRules-CTaxO-S2.js";const Xe=ye(B)({"& #b3-customForm-id-name":{'& label[data-shrink="true"]':{whiteSpace:"break-spaces",minWidth:"calc(133% - 24px)",transition:"unset"},'& label[data-shrink="false"]':{whiteSpace:"break-spaces"}}});function Bt(_){var P,H,O;const[N,w]=b.useState(""),[M,$]=b.useState(!1),{setOpenPage:G}=_,F=be(),[V]=Be(),{control:j,handleSubmit:W,getValues:C,formState:{errors:A},setValue:E,setError:L,watch:J}=xe({mode:"onSubmit"}),{state:{storeName:K,logo:k,blockPendingAccountOrderCreation:Q,registerEnabled:U}}=b.useContext(we),I=Qe(),X=Ee(({company:i})=>i.customer),{id:Y,firstName:Z,lastName:ee,emailAddress:q,phoneNumber:te}=X,{state:se,dispatch:p}=b.useContext(Le),{state:{companyAutoApproval:D,portalStyle:{backgroundColor:ae="#FEF9F5"}}}=b.useContext(Se),re=je(ae),x=(i=!1)=>{p({type:"loading",payload:{isLoading:i}})};b.useEffect(()=>{x(!1),U||I("/login")},[U]),b.useEffect(()=>{(async()=>{try{p&&(x(!0),p({type:"finishInfo",payload:{submitSuccess:!1}}));const l=await Re(3),o=((l==null?void 0:l.accountFormFields)||[]).map(e=>{const t=e;return Ge.includes((e==null?void 0:e.fieldId)||"")&&e.groupId===4&&(t.isRequired=!0,t.visible=!0),e}),s=We(o||[]),{countries:a}=await Te(),r=s.address.map(e=>{const t=e;return e.name==="country"&&(t.options=a,t.replaceOptions={label:"countryName",value:"countryName"}),e}),n={phone:te,first_name:Z,last_name:ee,email:q},d=s.contactInformation.map(e=>{const t=e;return t.disabled=!0,t.default=n[y(e.name)]||e.default,e.required&&!(e!=null&&e.default)&&(t.disabled=!1),e});p&&p({type:"all",payload:{isLoading:!1,storeName:K,bcTob2bContactInformation:[...d],bcTob2bCompanyExtraFields:[],bcTob2bCompanyInformation:[...s.businessDetails],bcTob2bAddressBasicFields:[...r],countryList:[...a]}})}catch(l){S.error(l)}})()},[]);const{bcTob2bContactInformation:u,isLoading:oe,bcTob2bCompanyInformation:h=[],bcTob2bAddressBasicFields:g=[],countryList:z=[],bcTob2bCompanyExtraFields:ne=[]}=se;b.useEffect(()=>{const i=(s,a="")=>{var d;const r=((d=z.find(e=>e.countryCode===s||e.countryName===s))==null?void 0:d.states)||[],n=g.find(e=>e.name==="state");n&&(r.length>0?(n.fieldType="dropdown",n.options=r):(n.fieldType="text",n.options=[])),E("state",a&&s&&(r.find(e=>e.stateCode===a)||r.length===0)?a:""),p({type:"stateList",payload:{stateList:r,bcTob2bAddressBasicFields:[...g]}})};(()=>{const s=C("country"),a=C("state");i(s,a)})();const o=J((s,{name:a,type:r})=>{const{country:n,state:d}=s;a==="country"&&r==="change"&&i(n,d)});return()=>o.unsubscribe()},[z]);const ie=async(i,l)=>{let o=[];if(i.length){i.forEach(s=>{o=l[s.name]||[]});try{return(await Promise.all(o.map(r=>Ne({file:r,type:"companyAttachedFile"})))).reduce((r,n)=>{let d=r;if(n.code===200){const e={...n.data};e.fileSize=e.fileSize?"".concat(e.fileSize):"",d=[...r,e]}else throw n.data.errMsg||n.message||F("intl.global.fileUpload.fileUploadFailure");return d},[])}catch(s){throw S.error(s),s}}},le=async(i,l,o,s)=>{const a={};a.customerId=l||"",a.storeHash=ke,a.userExtraFields=s;const r=h.filter(t=>!t.custom&&t.fieldType!=="files"),n=h.filter(t=>!!t.custom);if(r.length&&r.forEach(t=>{a[Je(y(t.name))]=i[t.name]||""}),n.length){const t=[];n.forEach(f=>{const m={};m.fieldName=y(f.name),m.fieldValue=i[f.name]||"",t.push(m)}),a.extraFields=t}const d=g.filter(t=>!t.custom),e=g.filter(t=>!!t.custom);if(d.length&&d.forEach(t=>{const f=y(t.name);f==="address1"&&(a.addressLine1=i[t.name]||""),f==="address2"&&(a.addressLine2=i[t.name]||""),a[f]=i[t.name]||""}),e.length){const t=[];e.forEach(f=>{const m={};m.fieldName=y(f.name),m.fieldValue=i[f.name]||"",t.push(m)}),a.addressExtraFields=t}return a.fileList=o,a.channelId=Me,Ve(a)},ce=async i=>{var l;try{const o=h.filter(r=>!!r.custom),s=o.map(r=>({fieldName:y(r.name),fieldValue:i[r.name]||r.default})),a=await Oe({extraFields:s});if(a.code!==200){const r=((l=a.data)==null?void 0:l.errMsg)||a.message||"",n=r.split(":");if(n.length>=2){const d=o.find(e=>y(e.name)===n[0]);if(d)return L(d.name,{type:"manual",message:n[1]}),x(!1),!1}throw r}return w(""),!0}catch(o){throw S.error(o),o}},de=()=>{var o;const i=C(),l=h.find(s=>s.fieldId==="field_attachments");return!Fe(l)&&l.required&&i[l.name].length===0?(L(l.name,{type:"required",message:F("global.validate.required",{label:(o=l.label)!=null?o:""})}),x(!1),!0):!1},me=i=>{if(u){const l=u.map(o=>o.name===i?{...o,disabled:!1}:o);p&&p({type:"all",payload:{bcTob2bContactInformation:[...l]}})}},ue=async i=>{var l;try{const o=await _e({extraFields:i});if(o.code!==200){const s=((l=o.data)==null?void 0:l.errMsg)||o.message||"",a=s.split(":");if(a.length>=2){const r=u==null?void 0:u.find(n=>n.custom&&Ke.decode(n.name)===a[0]);if(r)return L(r.name,{type:"manual",message:a[1]}),me(r.name),x(!1),!1}return w(s),x(!1),!1}return w(""),!0}catch(o){return!1}},fe=i=>{const l=de();W(async o=>{if(!l){x(!0);try{if(!await ce(o))return;const r=(u||[]).filter(m=>!!m.custom),n=[];r.length&&r.forEach(m=>{const R={};R.fieldName=y(m.name),R.fieldValue=o[m.name]||(m==null?void 0:m.default)||"",n.push(R)});let d=!0;if(n.length>0&&(d=await ue(n)),!d)return;const e=h.filter(m=>m.fieldType==="files"),t=await ie(e||[],o);await le(o,Y,t,n);const f=D.enabled;q&&(p({type:"finishInfo",payload:{submitSuccess:!0,isAutoApproval:f,blockPendingAccountOrderCreation:Q}}),p({type:"all",payload:{accountType:"1"}}),await ve(),$(!0))}catch(s){S.error(s),w((s==null?void 0:s.message)||s)}finally{x(!1)}}})(i)},pe=()=>{Ue(I,!0)&&(D.enabled?I("/orders"):window.location.href="/")};return c.jsx(Ce,{setOpenPage:G,children:c.jsx(qe,{isMobile:V,children:c.jsx(Ae,{isSpinning:oe,tip:F("global.tips.loading"),transparency:"0",children:c.jsxs(B,{sx:{display:"flex",flexDirection:"column",width:"100%",alignItems:"center","& h4":{color:re},"& input, & .MuiFormControl-root .MuiTextField-root, & .MuiDropzoneArea-textContainer, & .MuiSelect-select.MuiSelect-filled, & .MuiTextField-root .MuiInputBase-multiline":{borderRadius:"4px",borderBottomLeftRadius:"0",borderBottomRightRadius:"0"}},children:[k&&c.jsx(De,{children:c.jsx(he,{sx:{maxWidth:"250px"},onClick:()=>{window.location.href="/"},children:c.jsx("img",{src:"".concat(k),alt:F("global.tips.registerLogo"),loading:"lazy"})})}),M?c.jsx(ze,{activeStep:$e.length,handleFinish:pe,isBCToB2B:!0}):c.jsxs(Xe,{sx:{width:V?"100%":"537px",boxShadow:"0px 2px 1px -1px rgba(0, 0, 0, 0.2), 0px 1px 1px rgba(0, 0, 0, 0.14), 0px 1px 3px rgba(0, 0, 0, 0.12)",borderRadius:"4px",marginTop:"1rem",background:"#FFFFFF",padding:"0 0.8rem 1rem 0.8rem"},children:[c.jsx(Pe,{children:F("registeredbctob2b.title")}),N&&c.jsx(ge,{severity:"error",children:c.jsx(He,{children:N})}),c.jsxs(B,{sx:{width:"100%"},children:[c.jsx(v,{children:u!=null&&u.length?(P=u[0])==null?void 0:P.groupName:""}),c.jsx(T,{formFields:u||[],errors:A,control:j,getValues:C,setValue:E})]}),c.jsxs(B,{sx:{width:"100%"},children:[c.jsx(v,{children:h!=null&&h.length?(H=h[0])==null?void 0:H.groupName:""}),c.jsx(T,{formFields:[...h,...ne],errors:A,control:j,getValues:C,setValue:E,setError:L})]}),c.jsxs(B,{sx:{width:"100%"},children:[c.jsx(v,{children:g!=null&&g.length?(O=g[0])==null?void 0:O.groupName:""}),c.jsx(T,{formFields:g,errors:A,control:j,getValues:C,setValue:E})]}),!M&&c.jsx(B,{sx:{display:"flex",flexDirection:"row-reverse",pt:2,width:"100%"},children:c.jsx(Ie,{variant:"contained",onClick:fe,children:F("global.button.submit")})})]})]})})})})}export{Xe as StyledRegisterContent,Bt as default};
