System.register(["./mui-legacy-BDTphHaF.js","./reactVendor-legacy-CtYIj4Ma.js","./lang-legacy-C2M9M2Og.js","./B3Filter-legacy-cLJO6KUk.js","./react-setup-legacy-Bwwh9_Jr.js","../index-legacy.BPYbSXo1.js","./Edit-legacy-BuM8f0CG.js","./b3Logger-legacy-C5y5ZQF8.js","./address-legacy-BgusQrfm.js","./form-legacy-CAo5v63e.js","./lodashEs-legacy-Da1qF4L1.js","./B3CustomForm-legacy-BVFdU8az.js","./config-legacy-bN_WP51o.js","./config-legacy-82d9BLzm.js","./eStyled-legacy-D59194a7.js","./eReact-legacy-BRtOBtIF.js","./intl-legacy-DG3cM9-L.js","./eCache-legacy-BoIqTPuc.js","./B3FilterMore-legacy-CFk9nW9w.js","./dateFns-legacy-DV9BM4UY.js","./B3FilterSearch-legacy-DYz9XuR_.js","./redux-legacy-Dls004SH.js","./toolkit-legacy-6OFItfV5.js","./router-legacy-CCJEjNy7.js","./muiIcon-legacy-BXgwC5sb.js","./dropzone-legacy-B_7NAEdu.js","./validatorRules-legacy-DhhIqtMN.js"],(function(e,s){"use strict";var t,a,i,n,d,l,r,o,c,u,f,g,m,p,h,y,x,j,S,D,C,b,B,A,I,w,F,E,L,k,v,N,O,P,R,T,z,V,_,$,M,J,U,q,H,W,G,K,X,Y,Z,Q,ee,se,te,ae;return{setters:[e=>{t=e.s,a=e.j,i=e.v,n=e.w,d=e.x,l=e.J,r=e.ab,o=e.T,c=e.B,u=e.I,f=e.ac},e=>{g=e.r},e=>{m=e.u},e=>{p=e.B},e=>{h=e.B,y=e.a7,x=e.a8,j=e._,S=e.a5,D=e.a9,C=e.a3,b=e.aa,B=e.a,A=e.a4,I=e.u,w=e.p,F=e.G,E=e.R,L=e.ab,k=e.a2,v=e.ac,N=e.ad},null,e=>{O=e.d,P=e.u,R=e.a},e=>{T=e.b},e=>{z=e.c,V=e.u,_=e.a,$=e.b,M=e.d,J=e.e,U=e.g,q=e.f,H=e.h,W=e.i},e=>{G=e.u},e=>{K=e.c},e=>{X=e.B},e=>{Y=e.d,Z=e.g},e=>{Q=e.b,ee=e.a,se=e.f,te=e.c},e=>{ae=e.n},null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){e("default",(function(){const e=I(w),s=I((({company:e})=>e.companyInfo.id)),t=I((({company:e})=>e.customer.role)),i=I((({b2bFeatures:e})=>e.masqueradeCompany.id)),n=I((({b2bFeatures:e})=>e.masqueradeCompany.isAgenting)),{state:{addressConfig:d},dispatch:l}=g.useContext(F),{addressesActionsPermission:r}=I(E),o=m(),u=P(),[f]=R(),h=g.useRef(null),[y,x]=g.useState(!1),[j,D]=g.useState([]),[C,b]=g.useState([]),[B,A]=g.useState({search:""}),O=t===L.SUPER_ADMIN&&n?i:s;let z=!1,V=!1;e&&(!t||t===L.SUPER_ADMIN&&n)&&(z=!0),e&&(t!==L.SUPER_ADMIN||n)||(V=!0),g.useEffect((()=>{(async()=>{const{countries:e}=await N();b(e),x(!0);try{const s=await ue(!V,e);D(s||[])}catch(s){T.error(s)}finally{x(!1)}})()}),[]);const _=()=>{f.current?.refresh()},[$,M]=g.useState(!!e&&r),[J,U]=g.useState(!1),[G,K]=g.useState(!1),[X,Y]=g.useState();g.useEffect((()=>{(async()=>{if(V)M(!0);else if(z)try{let e=d;if(!e){const{addressConfig:s}=await W();e=s,l({type:"common",payload:{addressConfig:e}})}const s=3===t?"address_sales_rep":"address_admin",a="1"===(e||[]).find((e=>"address_book"===e.key))?.isEnabled&&"1"===(e||[]).find((e=>e.key===s))?.isEnabled&&r;M(a)}catch(e){T.error(e)}})()}),[d,z,V,t]);const Z=e=>{$?(Y({...e}),K(!0)):S.error(o("addresses.noPermissionToEdit"))},Q=e=>{Y({...e}),U(!0)},ee={isEnabled:$,customLabel:o("addresses.addNewAddress")},ae=JSON.parse(JSON.stringify(se));return ae.map((e=>(e.label=o(e.idLang),e))),a.jsx(k,{isSpinning:y,children:a.jsxs(c,{sx:{display:"flex",flexDirection:"column",flex:1},children:[a.jsx(p,{fiterMoreInfo:ae,handleChange:(e,s)=>{"search"===e&&A({...B,search:s})},handleFilterChange:e=>{A({...B,country:e.country||"",state:e.state||"",city:e.city||""})},customButtomConfig:ee,handleFilterCustomButtomClick:()=>{$?h.current?.handleOpenAddEditAddressClick("add"):S.error(o("addresses.noPermissionToAdd"))}}),a.jsx(v,{ref:f,columnItems:[],rowsPerPageOptions:[12,24,36],getRequestList:async(e={})=>{let s=[],t=0;if(V){const{customerAddresses:{edges:a=[],totalCount:i}}=await H({...e});s=a.map((e=>({node:te(e.node)}))),t=i}else{const{addresses:{edges:a=[],totalCount:i}}=await q({companyId:O,...e});s=a,t=i}return{edges:s,totalCount:t}},searchParams:B,isCustomRender:!0,itemXs:u?3:4,requestLoading:x,tableKey:"id",renderItem:e=>a.jsx(le,{item:e,onEdit:()=>(e=>{$?h.current?.handleOpenAddEditAddressClick("edit",e):S.error(o("addresses.noPermissionToEdit"))})(e),onDelete:Z,onSetDefault:Q,editPermission:$,isBCPermission:V},e.id)}),a.jsx(ie,{updateAddressList:_,addressFields:j,ref:h,companyId:O,isBCPermission:V,countries:C}),$&&!V&&a.jsx(oe,{isOpen:J,setIsOpen:U,setIsLoading:x,addressData:X,updateAddressList:_,companyId:O}),$&&a.jsx(re,{isOpen:G,setIsOpen:K,setIsLoading:x,addressData:X,updateAddressList:_,companyId:O,isBCPermission:V})]})})}));const s=t("div")((()=>({display:"flex","& div::first-of-type":{marginRight:"2rem"},"& div":{minWidth:"45%",display:"flex",flexDirection:"column"}}))),ie=g.forwardRef((function({addressFields:e,updateAddressList:t,companyId:d,isBCPermission:l,countries:r},o){const c=m(),[u,f]=g.useState(!1),[p,D]=g.useState(""),[C,b]=g.useState(!1),[B,A]=g.useState(e),[I,w]=g.useState([]),[F,E]=g.useState([]),[L,k]=g.useState(null),[v,N]=g.useState({isShipping:!1,isBilling:!1,isDefaultShipping:!1,isDefaultBilling:!1}),O=!l,{control:P,handleSubmit:R,getValues:T,formState:{errors:M},watch:J,setError:U,setValue:q,reset:H}=G({mode:"all"}),W=async e=>{try{const s=I.map((s=>({fieldName:Y(s.name),fieldValue:e[s.name]||s.default}))),t=await(e=>h.post("/api/v2/extra-fields/address/validate",y.B2BRest,{...e,storeHash:x}))({extraFields:s});if(200!==t.code){const e=t.data?.errMsg||t.message||"",s=e.split(":");if(s.length>=2){const e=I.find((e=>Y(e.name)===s[0]));if(e)return U(e.name,{type:"manual",message:s[1]}),b(!1),!1}throw e}return!0}catch(s){throw S.error(s),s}},Z=(e,s)=>{"add"===e&&F.length>0&&B.forEach((e=>{const s=e;if(e.custom)if(O){const t=F.filter((s=>s.name===e.name))[0];s.default=t.default||""}else{const t=F.filter((s=>s.name===e.name||s.bcLabel===e.bcLabel))[0];s.default=t.default||""}})),H(),k(s),D(e),f(!0)};return g.useImperativeHandle(o,(()=>({handleOpenAddEditAddressClick:Z}))),g.useEffect((()=>{const s=JSON.parse(JSON.stringify(e));s.forEach((e=>{const s=e;return s.label=c(e.idLang)||e.label,O||"field_21"!==e.fieldId||(s.default=""),e})),A(s);const t=e.filter((e=>e.custom));if(w(t),0===F.length){const s=K(e);E(s)}}),[e,F.length,O]),g.useEffect((()=>{u&&"edit"===p&&L&&(()=>{if(L){const{isShipping:e,isBilling:s,isDefaultShipping:t,isDefaultBilling:a,state:i,stateCode:n,countryCode:d,extraFields:l}=L,o=r.filter((e=>e.countryCode===d));N({isShipping:1===e,isBilling:1===s,isDefaultShipping:1===t,isDefaultBilling:1===a}),B.forEach((e=>{const s=e;if(s.custom&&l.length>0)if(O){const e=Y(s.name),t=l.find((s=>s.fieldName===e)),a=F.find((s=>s.name===e));t?(q(s.name,t.fieldValue||""),s.default=t.fieldValue||""):(q(s.name,""),s.default=a.default)}else{const e=l.find((e=>e.fieldName===s.name||e.fieldName===s.bcLabel)),t=F.filter((e=>e.name===s.name||e.bcLabel===s.bcLabel))[0];e?(q(s.name,e.fieldValue||""),s.default=e.fieldValue||t.default):(q(s.name,""),s.default=t.default)}else if("country"===s.name)q(s.name,d);else if("state"===s.name){if(q(s.name,n||i),o[0]){const{states:e}=o[0];e.length>0?(s.options=e,s.fieldType="dropdown"):(s.options=[],s.fieldType="text")}}else q(s.name,"undefined"===L[s.name]?"":L[s.name])}))}})()}),[L,B,r,O,u,F,q,p]),g.useEffect((()=>{const e=J(((e,{name:s,type:t})=>{const{country:a}=e;"country"===s&&"change"===t&&(e=>{const s=r.find((s=>s.countryCode===e))?.states||[],t=B.find((e=>"state"===e.name));t&&(s.length>0?(t.fieldType="dropdown",t.options=s):(t.fieldType="text",t.options=[])),q("state",""),A([...B])})(a)}));return()=>e.unsubscribe()}),[B,r,J]),a.jsxs(j,{isOpen:u,title:c("add"===p?"addresses.addressForm.addNewAddress":"addresses.addressForm.editAddress"),leftSizeBtn:c("addresses.addressForm.cancel"),rightSizeBtn:c("addresses.addressForm.saveAddress"),handleLeftClick:()=>{H(),N({isShipping:!1,isBilling:!1,isDefaultShipping:!1,isDefaultBilling:!1}),f(!1),D("")},handRightClick:()=>{O?R((async e=>{b(!0);try{if(!(await W(e)))return;const s=I.map((s=>({fieldName:Y(s.name),fieldValue:e[s.name]||s.default}))),{country:a,state:i}=e;let n="",l="",o=i;r.forEach((e=>{const{countryName:s,countryCode:t,states:d}=e;if(t===a)if(n=s,d.length>0){const e=d.find((e=>e.stateCode===o||e.stateName===o));l=e?.stateName||l,o=e?.stateCode||o}else o="",l=i}));const u={...e,companyId:+d,extraFields:s,isShipping:v.isShipping?1:0,isBilling:v.isBilling?1:0,isDefaultShipping:v.isDefaultShipping?1:0,isDefaultBilling:v.isDefaultBilling?1:0,country:n,countryCode:a,state:l,stateCode:o};if("add"===p)await z(u),S.success(c("addresses.addressForm.newAddressAdded"));else if("edit"===p&&L){const{id:e}=L;await V({...u,id:+e}),S.success(c("addresses.addressForm.addressUpdated"))}N({isShipping:!1,isBilling:!1,isDefaultShipping:!1,isDefaultBilling:!1}),f(!1),await t(!0)}catch(s){S.error(s)}finally{b(!1)}}))():R((async e=>{b(!0);try{const s=I.map((s=>({name:s.bcLabel,value:e[s.name]||s.default}))),{country:a,state:i}=e;let n="",d="",l=i;r.forEach((e=>{const{countryName:s,countryCode:t,states:r}=e;if(t===a)if(n=s,r.length>0){const e=r.find((e=>e.stateCode===l||e.stateName===l));d=e?.stateName||d,l=e?.stateCode||l}else l="",d=i}));const o={...e,formFields:s,country:n,countryCode:a,state:d,stateCode:l,addressType:""};if("add"===p)await _(o),S.success(c("addresses.addressForm.newAddressAdded"));else if("edit"===p&&L){const{bcAddressId:e}=L;e&&await $({...o,id:+e}),S.success(c("addresses.addressForm.addressUpdated"))}f(!1),await t(!0)}catch(s){S.error(s)}finally{b(!1)}}))()},loading:C,isShowBordered:!0,children:[O&&a.jsxs(a.Fragment,{children:[a.jsx("p",{children:c("addresses.addressForm.selectAddressType")}),a.jsx(s,{children:Q.map((e=>{const{child:s,name:t,idLang:d}=e;return a.jsxs("div",{children:[a.jsx(i,{control:a.jsx(n,{checked:v[t],onChange:e=>{((e,s)=>{N("isShipping"===s?{...v,[s]:e,isDefaultShipping:!1}:{...v,[s]:e,isDefaultBilling:!1})})(e.target.checked,t)}}),label:c(d)}),s&&a.jsx(i,{control:a.jsx(n,{checked:v[s.name],onChange:()=>{N({...v,[s.name]:!v[s.name]})}}),label:c(s.idLang),sx:{display:v[t]?"":"none"}})]},t)}))})]}),a.jsx(X,{formFields:B,errors:M,control:P,getValues:T,setValue:q})]})})),ne=ae("div")((({marginBottom:e})=>({marginBottom:e,"& > span:not(:last-child)":{marginRight:"4px"}}))),de=ae("div")((({theme:e})=>({display:"flex",alignItems:"center",justifyContent:"space-between",marginTop:e.spacing(3)})));function le(e){const{item:s,onEdit:t,onDelete:i,onSetDefault:n,editPermission:f,isBCPermission:g}=e,p=d(),h=m();return a.jsx(l,{children:a.jsxs(r,{sx:{color:"#313440",wordBreak:"break-word"},children:[s.label&&a.jsx(o,{variant:"h5",sx:{marginBottom:1===s.isDefaultShipping||1===s.isDefaultBilling?p.spacing(1):p.spacing(3),color:"rgba(0, 0, 0, 0.87)"},children:s.label}),a.jsxs(ne,{marginBottom:1===s.isDefaultShipping||1===s.isDefaultBilling?p.spacing(3):0,children:[1===s.isDefaultShipping&&a.jsx(D,{color:"#C4DD6C",textColor:"rgba(0, 0, 0, 0.87)",children:h("addresses.addressItemCard.defaultShipping")}),1===s.isDefaultBilling&&a.jsx(D,{color:"#C4DD6C",textColor:"rgba(0, 0, 0, 0.87)",children:h("addresses.addressItemCard.defaultBilling")})]}),a.jsx(o,{variant:"body1",children:`${s.firstName} ${s.lastName}`}),a.jsx(o,{variant:"body1",children:s.company||""}),a.jsx(o,{variant:"body1",children:s.addressLine1}),a.jsx(o,{variant:"body1",children:"undefined"===s.addressLine2?"":s.addressLine2}),a.jsx(o,{variant:"body1",children:`${s.city}, ${s.state} ${s.zipCode}, ${s.country}`}),a.jsx(o,{variant:"body1",children:s.phoneNumber}),f&&a.jsxs(de,{children:[!g&&a.jsx(C,{variant:"text",sx:{ml:"-8px"},onClick:()=>{n(s)},children:h("addresses.addressItemCard.setAsDefault")}),a.jsxs(c,{sx:{flex:1,display:"flex",justifyContent:"flex-end"},children:[a.jsx(u,{"aria-label":"edit",size:"small",sx:{marginRight:"8px"},onClick:()=>{t(s)},children:a.jsx(O,{fontSize:"inherit"})}),a.jsx(u,{"aria-label":"delete",size:"small",onClick:()=>{i(s)},children:a.jsx(b,{fontSize:"inherit"})})]})]})]})},s.id)}function re(e){const{isOpen:s,setIsOpen:t,addressData:i,updateAddressList:n,setIsLoading:d,companyId:l,isBCPermission:r}=e,[o]=B(),u=m();return a.jsx(j,{isOpen:s,title:u("addresses.deleteAddressDialog.deleteAddress"),leftSizeBtn:u("addresses.deleteAddressDialog.cancel"),rightSizeBtn:u("addresses.deleteAddressDialog.delete"),handleLeftClick:()=>{t(!1)},handRightClick:async()=>{if(i)try{d(!0),t(!1);const{id:e="",bcAddressId:s=""}=i;r?await J({bcAddressId:s}):await M({addressId:e,companyId:l}),S.success(u("addresses.deleteAddressDialog.successfullyDeleted")),n()}catch(e){d(!1)}},rightStyleBtn:{color:"#D32F2F"},isShowBordered:!1,children:a.jsx(c,{sx:{display:"flex",alignItems:o?"start":"center",justifyContent:o?"center":"start",width:o?"100%":"450px",height:"100%"},children:u("addresses.deleteAddressDialog.confirmDelete")})})}function oe(e){const{isOpen:s,setIsOpen:t,setIsLoading:d,addressData:l,updateAddressList:r,companyId:o}=e,[u]=B(),p=m(),[h,y]=g.useState();g.useEffect((()=>{y(l)}),[l]);const x=e=>s=>{const{checked:t}=s.target;if(h){const s={...h};"isDefaultShipping"===e&&(s.isDefaultShipping=t?1:0,s.isShipping=t?1:s.isShipping),"isDefaultBilling"===e&&(s.isDefaultBilling=t?1:0,s.isBilling=t?1:s.isShipping),y(s)}};return a.jsx(j,{isOpen:s,title:p("addresses.setDefaultDialog.setDefaultAddress"),leftSizeBtn:p("addresses.setDefaultDialog.cancel"),rightSizeBtn:"set",handleLeftClick:()=>{t(!1)},handRightClick:async()=>{try{d(!0),t(!1),await V({...h,companyId:o}),S.success(p("addresses.setDefaultDialog.successfullySet")),r()}catch(e){d(!1)}},children:a.jsx(c,{sx:{display:"flex",alignItems:u?"start":"center",justifyContent:u?"center%":"start",width:u?"100%":"450px",height:"100%"},children:h&&a.jsx(c,{sx:{padding:u?"0":"10px 0"},children:a.jsxs(f,{children:[a.jsx(i,{control:a.jsx(n,{checked:1===h.isDefaultShipping,onChange:x("isDefaultShipping")}),label:p("addresses.setDefaultDialog.setDefaultShippingAddress")}),a.jsx(i,{control:a.jsx(n,{checked:1===h.isDefaultBilling,onChange:x("isDefaultBilling")}),label:p("addresses.setDefaultDialog.setDefaultBillingAddress")})]})})})})}const ce=async()=>{try{const e=(e=>{if(0===e.length)return[];const s=e.filter((e=>e.visibleToEnduser))||[];if(0===s?.length)return[];const t=s.map((e=>({...e,groupId:4,visible:e.visibleToEnduser}))),a=Z(t).address;return a.map((e=>(e.custom=!0,e))),a})((await U()).addressExtraFields);return[...ee,...e]}catch(e){T.error(e)}return[]},ue=async(e,s)=>{let t=[];try{if(e){const e=await ce();e&&(t=e)}else t=await(async()=>{try{const{accountFormFields:e}=await A(1),s=e.filter((e=>4===e.groupId));return Z(s).address}catch(e){T.error(e)}})();return t.map((e=>{const t=e;return"country"===e.name&&(t.options=s),"state"===e.name&&(t.fieldType="text"),e})),t}catch(a){T.error(a)}return[]}}}}));
