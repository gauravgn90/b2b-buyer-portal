import{j as n,J as se,ab as te,T as Y,B as G,I as X}from"./mui-5MYSBV5R.js";import{r as i}from"./reactVendor-BAhb8EbJ.js";import{u as K}from"./lang-BFcXlKUT.js";import{u as k,_ as Q,aA as D,a5 as W,a6 as ae,aa as ne,a9 as re,a as le,ab as oe,R as ie,a2 as de,ac as ce}from"./react-setup-B89zJiq4.js";import{B as ue}from"./B3Filter-B8HZ1N9c.js";import"../index.CgW3dhwJ.js";import{d as me,u as fe,a as pe}from"./Edit-71tYTg2e.js";import{g as xe,b as ge,a as he,d as ye,e as be}from"./users-BdTCmaEu.js";import{u as Re}from"./form-Bvi8lP6x.js";import{f as Ee}from"./lodashEs-Ck10JMnh.js";import{B as Ce}from"./B3CustomForm-DjrjSYXN.js";import{b as Ie}from"./b3Logger-CMQiGC3f.js";import{n as Fe}from"./eStyled-BQSmO2oX.js";import"./eReact-DeS39u1B.js";import"./intl-CIPMD0ue.js";import"./eCache-BQInSoPa.js";import"./redux-B-shcavw.js";import"./toolkit-CHPG993j.js";import"./router-BbCjXwHs.js";import"./muiIcon-Du0m7JKT.js";import"./dateFns-CE3kB2v1.js";import"./dropzone-CHkuoC7V.js";import"./B3FilterMore-D4S_BlgN.js";import"./B3FilterSearch-zd7_SPrR.js";const Ue=()=>[{label:"Admin",name:"Admin",value:0,idLang:"userManagement.userRole.admin"},{label:"Senior buyer",name:"Senior Buyer",value:1,idLang:"userManagement.userRole.seniorBuyer"},{label:"Junior buyer",name:"Junior Buyer",value:2,idLang:"userManagement.userRole.juniorBuyer"}],Z=d=>[{name:"companyRoleId",label:d("userManagement.config.userRole"),required:!1,default:"",defaultName:"",fieldType:"roleAutocomplete",xs:12,disabled:!1,variant:"filled",size:"small"}],Ne=(d,t,r=!1)=>{const c=Z(t);return c[0].required=!0,c[0].disabled=r,[...c,{name:"email",label:t("userManagement.config.email"),required:!0,fieldType:"text",xs:12,disabled:d==="edit",default:"",variant:"filled",size:"small"},{name:"firstName",label:t("userManagement.config.firstName"),required:!0,default:"",fieldType:"text",xs:6,variant:"filled",size:"small"},{name:"lastName",label:t("userManagement.config.lastName"),required:!0,fieldType:"text",xs:6,default:"",variant:"filled",size:"small"},{name:"phone",label:t("userManagement.config.phoneNumber"),required:!1,fieldType:"text",xs:12,default:"",variant:"filled",size:"small"}]},Se={3:"global.emailValidate.multipleCustomer",4:"global.emailValidate.companyUsed",5:"global.emailValidate.alreadyExits",6:"global.emailValidate.usedSuperAdmin"},Be={0:"text",1:"multiline",2:"number",3:"dropdown"},Le=d=>d.map(r=>{const{listOfValue:c}=r,p=Be[r.fieldType],x={isExtraFields:!0,name:r.fieldName,label:r.labelName,required:r.isRequired,default:r.defaultValue||"",fieldType:p,xs:12,variant:"filled",size:"small"};switch(p){case"dropdown":if(c){const l=c==null?void 0:c.map(y=>({label:y,value:y}));l.length>0&&(x.options=l)}break;case"number":x.max=r.maximumValue||"";break;case"mutiline":x.rows=r.numberOfRows||"";break;default:x.maxLength=r.maximumLength||"";break}return x}),Me=async()=>{let d=[];try{const{userExtraFields:t}=await xe(),r=t.filter(p=>p.visibleToEnduser);d=Le(r)}catch(t){Ie.error(t)}return d};function ke({companyId:d,renderList:t},r){const c=k(({company:s})=>s.customer.b2bId),[p,x]=i.useState(!1),[l,y]=i.useState(""),[b,m]=i.useState(null),[S,C]=i.useState(!1),[I,O]=i.useState([]),[F,B]=i.useState([]),g=K(),{control:P,handleSubmit:V,getValues:w,formState:{errors:E},clearErrors:T,setValue:U,setError:j}=Re({mode:"onSubmit"}),_=async()=>{const s=await Me();B(s)};i.useEffect(()=>{F.length===0&&_()},[F.length]);const L=s=>{const a=Object.keys(s),u=[];return F.forEach(f=>{if(a.includes(f.name)){const R={fieldName:f.name||"",fieldValue:s[f.name]||""};u.push(R)}}),u};i.useEffect(()=>{if(p){const s=I.map(a=>{const u=a;return l==="edit"&&b&&U(a.name,b[a.name]),u});O(s)}},[b,p,l]);const A=()=>{I.forEach(s=>{U(s.name,""),s.isExtraFields&&U(s.name,s.default||"")}),T(),x(!1)},v=async s=>{const{userType:a,userInfo:{companyName:u}}=await he({email:s,companyId:d,channelId:ae}),f=[D.DOESNT_EXIST,D.B2C,D.CURRENT_B2B_COMPANY_DIFFERENT_CHANNEL].includes(a);return f||j("email",{type:"custom",message:g(Se[a],{companyName:u?"(".concat(u,")"):"",email:s})}),{isValid:f,userType:a}},q=()=>{V(async s=>{C(!0);const a=L(s);let u=g("userManagement.addUserSuccessfully");try{const f={companyId:d,companyRoleId:+s.companyRoleId,...s,extraFields:a};if(l!=="edit"){const{isValid:R,userType:N}=await v(s.email);if(!R){C(!1);return}N===D.CURRENT_B2B_COMPANY_DIFFERENT_CHANNEL&&(f.addChannel=!0,u=g("userManagement.userDetected",{email:s.email}))}l==="edit"&&(f.userId=(b==null?void 0:b.id)||"",u=g("userManagement.updateUserSuccessfully"),delete f.email),await ge(f),A(),W.success(u),t()}finally{C(!1)}})()},z=(s,a)=>{const u=Ne(s,g,s==="edit"?c===+a.id:!1);if(s==="edit"){const R=a.extraFields||[];let N=a;if(R&&R.length>0){const e={};R.forEach(o=>{e[o.fieldName]=o.fieldValue}),N={...a,...e}}m(N);const M=u.find(e=>e.name==="companyRoleId")||null;M&&(M.defaultName=(a==null?void 0:a.companyRoleName)||"",M.default=(a==null?void 0:a.companyRoleId)||"")}const f=Ee(u,F);O(f),y(s),x(!0)};return i.useImperativeHandle(r,()=>({handleOpenAddEditUserClick:z})),n.jsx(Q,{isOpen:p,title:"".concat(g(l==="edit"?"userManagement.editUser":"userManagement.addNewUser")),leftSizeBtn:g("userManagement.cancel"),rightSizeBtn:g("userManagement.saveUser"),handleLeftClick:A,handRightClick:q,loading:S,isShowBordered:!0,children:n.jsx(Ce,{formFields:I,errors:E,control:P,getValues:w,setValue:U})})}const we=i.forwardRef(ke),Te=Fe("div")(()=>({display:"flex",alignItems:"center",justifyContent:"space-between"}));function je(d){const{item:t,onEdit:r,onDelete:c,isPermissions:p}=d,x=()=>Ue().map(m=>+m.value==2?t.companyRoleName!=="Junior Buyer"?{color:"#ce93d8",textColor:"black",...m,label:t.companyRoleName,name:t.companyRoleName}:{color:"#D9DCE9",textColor:"black",...m}:+m.value==1?{color:"rgba(237, 108, 2, 0.3)",textColor:"black",...m}:{color:"#C4DD6C",textColor:"black",...m}),l=y=>{const m=x().find(S=>S.name===y);return m?n.jsx(re,{color:m.color,textColor:m.textColor,children:m.label}):null};return n.jsx(se,{children:n.jsxs(te,{sx:{color:"#313440"},children:[n.jsxs(Y,{variant:"h5",sx:{color:"rgba(0, 0, 0, 0.87)"},children:[t.firstName," ",t.lastName]}),n.jsx(Y,{sx:{p:"15px 0"},variant:"body1",children:t.email}),n.jsxs(Te,{children:[l(t.companyRoleName),n.jsxs(G,{sx:{display:"".concat(p?"block":"none")},children:[n.jsx(X,{"aria-label":"edit",size:"small",sx:{marginRight:"8px"},onClick:()=>{r(t)},children:n.jsx(me,{fontSize:"inherit"})}),n.jsx(X,{"aria-label":"delete",size:"small",onClick:()=>{c(t)},children:n.jsx(ne,{fontSize:"inherit"})})]})]})]})},t.id)}function rs(){const[d,t]=i.useState(!1),[r,c]=i.useState(!1),[p,x]=i.useState({createdAt:0,email:"",firstName:"",id:"",lastName:"",phone:"",role:0,updatedAt:0,extraFields:[],companyRoleName:"",companyRoleId:""}),l=K(),[y]=le(),b=fe(),m=k(({b2bFeatures:e})=>e.masqueradeCompany.id),S=k(({company:e})=>e.customer.role),C=k(({company:e})=>e.companyInfo),I=+S===oe.SUPER_ADMIN?m:C==null?void 0:C.id,F=k(ie).userActionsPermission,B=i.useRef(null),[g]=pe(),P={isEnabled:F,customLabel:l("userManagement.addUser")},V={search:"",companyRoleId:"",companyId:I},w=Z(l),[E,T]=i.useState(V),[U,j]=i.useState(w),[_,L]=i.useState(""),A=async e=>{const o=await ye(e),{users:{edges:h,totalCount:$}}=o;return{edges:h,totalCount:$}},v=()=>{var e;(e=g.current)==null||e.refresh()},q=()=>{const e=w.map(o=>{var H;const h=o,$=(H=o.options)==null?void 0:H.map(J=>{const ee=J;return ee.label=l(J.idLang),J});return h.options=$,h.setValueName=L,h.default=E.companyRoleId,h.defaultName=E.companyRoleId?_:"",o});return j(e),e},z=(e,o)=>{const h={...E,q:o};T(h)},s=e=>{const o={...E,companyRoleId:e.companyRoleId,offset:0};T(o)},a=()=>{var e;(e=B.current)==null||e.handleOpenAddEditUserClick("add")},u=e=>{var o;(o=B.current)==null||o.handleOpenAddEditUserClick("edit",e)},f=e=>{x(e),c(!0)},R=()=>{c(!1)},N=async e=>{if(e)try{t(!0),R(),await be({userId:e.id||"",companyId:I}),W.success(l("userManagement.deleteUserSuccessfully"))}finally{t(!1),v()}},M=()=>{const e=U.map(o=>{const h=o;return h.setValueName=L,h.defaultName="",o});L(""),j(e)};return i.useEffect(()=>{q()},[E,E.companyRoleId]),n.jsx(de,{isSpinning:d,children:n.jsxs(G,{sx:{display:"flex",flexDirection:"column",flex:1},children:[n.jsx(ue,{fiterMoreInfo:U,handleChange:z,handleFilterChange:s,customButtomConfig:P,handleFilterCustomButtomClick:a,resetFilterInfo:M}),n.jsx(ce,{ref:g,columnItems:[],rowsPerPageOptions:[12,24,36],getRequestList:A,searchParams:E||{},isCustomRender:!0,itemXs:b?3:4,requestLoading:t,renderItem:e=>n.jsx(je,{item:e,isPermissions:F,onEdit:u,onDelete:f},e.id||"")}),n.jsx(we,{companyId:I,renderList:v,ref:B}),n.jsx(Q,{isOpen:r,title:l("userManagement.deleteUser"),leftSizeBtn:l("userManagement.cancel"),rightSizeBtn:l("userManagement.delete"),handleLeftClick:R,handRightClick:N,row:p,rightStyleBtn:{color:"#D32F2F"},isShowBordered:!1,children:n.jsx(G,{sx:{display:"flex",justifyContent:"".concat(y?"center%":"start"),width:"".concat(y?"100%":"450px"),height:"100%"},children:l("userManagement.confirmDelete")})})]})})}export{rs as default};
