import{j as s,o as rs,T as K,B,J as cs,ab as ps,I as q}from"./mui-5MYSBV5R.js";import{r as a}from"./reactVendor-BAhb8EbJ.js";import{u as V}from"./lang-BFcXlKUT.js";import{u as C,R as H,_ as Y,a_ as ls,a$ as ds,bM as us,bN as hs,a6 as U,bO as fs,bP as ms,a5 as Z,r as gs,aB as Ls,al as Ss,a3 as xs,aa as Bs,a as Cs,G as ys,p as bs,a2 as js,ac as Is,br as Ps,b0 as Es,b1 as vs,bQ as Fs,bR as ks}from"./react-setup-B89zJiq4.js";import{B as ws}from"./B3Filter-B8HZ1N9c.js";import"../index.CgW3dhwJ.js";import{d as Rs,a as As,u as Os}from"./Edit-71tYTg2e.js";import{u as zs}from"./form-Bvi8lP6x.js";import{B as Ds}from"./B3CustomForm-DjrjSYXN.js";import{g as _s,S as Ns,a as Ts}from"./ShoppingStatus-ZqwuiFyv.js";import{n as J}from"./eStyled-BQSmO2oX.js";import{i as qs}from"./lodashEs-Ck10JMnh.js";import{u as Ms}from"./router-BbCjXwHs.js";import"./eReact-DeS39u1B.js";import"./intl-CIPMD0ue.js";import"./eCache-BQInSoPa.js";import"./redux-B-shcavw.js";import"./toolkit-CHPG993j.js";import"./muiIcon-Du0m7JKT.js";import"./dateFns-CE3kB2v1.js";import"./dropzone-CHkuoC7V.js";import"./b3Logger-CMQiGC3f.js";import"./B3FilterMore-D4S_BlgN.js";import"./B3FilterSearch-zd7_SPrR.js";function $s({renderList:v,isB2BUser:t},F){const y=C(H),[u,b]=a.useState(!1),[c,f]=a.useState(""),[o,j]=a.useState(null),[p,m]=a.useState(!1),[g,k]=a.useState([]),i=V(),{control:w,handleSubmit:I,getValues:n,formState:{errors:P},clearErrors:R,setValue:l}=zs({mode:"onSubmit"});a.useEffect(()=>{u&&c!=="add"&&o&&g.forEach(h=>{l(h.name,o[h.name])})},[o,u,l,c,g]);const L=()=>{g.forEach(h=>{l(h.name,"")}),R(),b(!1)},D=()=>{I(async h=>{m(!0);try{const d={...h};let S=t?ls:ds,A=i("shoppingLists.addSuccess");if(c==="edit")t?(S=us,d.status=o==null?void 0:o.status):(S=hs,d.channelId=U),d.id=(o==null?void 0:o.id)||0,A=i("shoppingLists.updateSuccess");else if(c==="dup")S=t?fs:ms,d.sampleShoppingListId=(o==null?void 0:o.id)||0,A=i("shoppingLists.duplicateSuccess");else if(c==="add")if(t){const{submitShoppingListPermission:_}=y;d.status=_?30:0}else d.channelId=U;await S(d),L(),Z.success(A),v()}finally{m(!1)}})()},z=(h,d)=>{const S=_s(i);k(S),d&&j(d),f(h),b(!0)};a.useImperativeHandle(F,()=>({handleOpenAddEditShoppingListsClick:z}));const E=()=>i(c==="edit"?"shoppingLists.edit":c==="add"?"shoppingLists.createNewShoppingList":"shoppingLists.duplicateShoppingList");return s.jsx(Y,{isOpen:u,title:E(),leftSizeBtn:i("shoppingLists.cancel"),rightSizeBtn:i("shoppingLists.save"),handleLeftClick:L,handRightClick:D,loading:p,children:s.jsx(Ds,{formFields:g,errors:P,control:w,getValues:n,setValue:l})})}const Us=a.forwardRef($s);var W={},Vs=rs;Object.defineProperty(W,"__esModule",{value:!0});var ss=W.default=void 0,Hs=Vs(gs()),Js=s;ss=W.default=(0,Hs.default)((0,Js.jsx)("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"}),"ContentCopy");const Ws=J("div")(()=>({display:"flex",alignItems:"center",justifyContent:"space-between"})),M=J(K)(()=>({fontWeight:"500",paddingRight:"5px"})),$=J(B)(()=>({display:"flex",alignItems:"center",justifyContent:"start"}));function Gs(v){const{item:t,onEdit:F,onDelete:y,onCopy:u,isPermissions:b,isB2BUser:c}=v,f=V(),[o,j]=a.useState(!0),p=C(({company:n})=>n.permissions),{submitShoppingListPermission:m,approveShoppingListPermission:g}=C(H),k=n=>m?!(n===30||n===0):n===40,i=n=>m?!(n===20||n===30):!1,w=Ms(),I=n=>w("/shoppingList/".concat(n.id),{state:{from:"shoppingList"}});return a.useEffect(()=>{if(c){const n=p.find(l=>l.code==="deplicate_shopping_list"),P=[];if(n&&!qs(n)){const l=n.permissionLevel,L=(t==null?void 0:t.isOwner)||!1;P.push({permissionType:"shoppingListActionsPermission",permissionLevel:l===1&&L?l:2})}const{shoppingListActionsPermission:R}=Ls(P);j(R)}},[t,c]),s.jsx(cs,{sx:{"& .b2b-card-content":{paddingBottom:"16px"}},children:s.jsxs(ps,{className:"b2b-card-content",sx:{color:"#313440"},children:[s.jsx(K,{variant:"h5",sx:{color:"rgba(0, 0, 0, 0.87)",width:"100%",wordBreak:"break-all"},children:t.name}),s.jsxs(B,{sx:{pt:"8px",pb:"20px"},children:[c&&(m||g&&t.approvedFlag)&&s.jsx(B,{sx:{pb:"25px"},children:s.jsx(Ns,{status:t.status})}),s.jsx(B,{sx:{width:"100%",wordBreak:"break-all"},children:t.description}),c&&s.jsxs($,{children:[s.jsx(M,{children:f("shoppingLists.card.createdBy")}),t.customerInfo.firstName," ",t.customerInfo.lastName]}),s.jsxs($,{children:[s.jsx(M,{children:f("shoppingLists.card.products")}),t.products.totalCount]}),s.jsxs($,{children:[s.jsx(M,{children:f("shoppingLists.card.lastActivity")}),"".concat(Ss(t.updatedAt))]})]}),s.jsxs(Ws,{children:[s.jsx(xs,{sx:{m:"0 0 0 -8px",minWidth:0},variant:"text",onClick:()=>I(t),children:f("shoppingLists.card.view")}),s.jsxs(B,{sx:{display:"".concat(b?"block":"none")},children:[!k(t.status)&&o&&s.jsx(q,{"aria-label":"edit",size:"medium",sx:{marginRight:"8px"},onClick:()=>{F(t)},children:s.jsx(Rs,{fontSize:"inherit"})}),s.jsx(q,{"aria-label":"duplicate",size:"medium",sx:{marginRight:"8px"},onClick:()=>{u(t)},children:s.jsx(ss,{fontSize:"inherit"})}),!i(t.status)&&o&&s.jsx(q,{"aria-label":"delete",size:"medium",onClick:()=>{y(t)},children:s.jsx(Bs,{fontSize:"inherit"})})]})]})]})},t.id)}function xe(){const[v,t]=a.useState(!1),[F,y]=a.useState(!1),[u,b]=a.useState(null),[c,f]=a.useState([]),[o]=Cs(),[j]=As(),p=V(),m=C(({b2bFeatures:e})=>e.masqueradeCompany.id),{state:{openAPPParams:g},dispatch:k}=a.useContext(ys),i=C(bs),w=C(({company:e})=>e.companyInfo.id),{shoppingListActionsPermission:I,submitShoppingListPermission:n}=C(H);a.useEffect(()=>{(async()=>{const r=w||m;let x={};i&&(x=await Ps(+r,1));const N=Ts(x,n),Q=JSON.parse(JSON.stringify(N));Q.forEach(O=>{var X;const os=O;return os.label=p(O.idLang),O.name==="status"&&((X=O.options)==null||X.map(T=>{const as=T;return as.label=p(T.idLang),T})),O}),f(Q)})(),g.shoppingListBtn&&k({type:"common",payload:{openAPPParams:{quoteBtn:"",shoppingListBtn:""}}})},[]);const P=Os(),R={isEnabled:i?I:!0,customLabel:p("shoppingLists.createNew"),customButtomStyle:{fontSize:"15px",fontWeight:"500",width:"140px",padding:"0"}},l=n?"":[0,40],L={search:"",createdBy:"",status:l,isDefault:!0},[D,z]=a.useState(L),E=a.useRef(null),h=()=>{var e;(e=j.current)==null||e.refresh()},d=(e,r)=>{if(e==="search"){const x={...L,search:r};z(x)}},S=e=>{const{status:r}=e,x=r===""||r===99?l:r,N={...L,createdBy:e.createdBy,status:x,isDefault:r===""};z(N)},A=async e=>{const{edges:r,totalCount:x}=i?await Es(e):await vs({offset:e.offset,first:e.first,search:e.search,channelId:U});return{edges:r,totalCount:x}},_=()=>{var e;(e=E.current)==null||e.handleOpenAddEditShoppingListsClick("add")},es=e=>{var r;(r=E.current)==null||r.handleOpenAddEditShoppingListsClick("edit",e)},ts=e=>{var r;(r=E.current)==null||r.handleOpenAddEditShoppingListsClick("dup",e)},is=e=>{b(e),y(!0)},G=()=>{y(!1)},ns=async()=>{if(u)try{t(!0),G();const e=(u==null?void 0:u.id)||0;i?await Fs(e):await ks(e),Z.success(p("shoppingLists.deleteSuccess"))}finally{t(!1),h()}};return s.jsx(js,{isSpinning:v,children:s.jsxs(B,{sx:{display:"flex",flexDirection:"column",flex:1},children:[s.jsx(ws,{showB3FilterMoreIcon:i,fiterMoreInfo:c,handleChange:d,handleFilterChange:S,customButtomConfig:R,handleFilterCustomButtomClick:_}),s.jsx(Is,{columnItems:[],ref:j,rowsPerPageOptions:[12,24,36],getRequestList:A,searchParams:D,isCustomRender:!0,itemXs:P?3:4,requestLoading:t,renderItem:e=>s.jsx(Gs,{item:e,isPermissions:i?I:!0,onEdit:es,onDelete:is,onCopy:ts,isB2BUser:i},e.id||"")}),s.jsx(Us,{renderList:h,ref:E,isB2BUser:i}),s.jsx(Y,{isOpen:F,title:p("shoppingLists.deleteShoppingList"),leftSizeBtn:p("shoppingLists.cancel"),rightSizeBtn:p("shoppingLists.delete"),handleLeftClick:G,handRightClick:ns,row:u,rightStyleBtn:{color:"#D32F2F"},isShowBordered:!1,children:s.jsx(B,{sx:{display:"flex",justifyContent:"".concat(o?"center%":"start"),width:"".concat(o?"100%":"450px"),height:"100%"},children:p("shoppingLists.confirmDelete")})})]})})}export{xe as default};
