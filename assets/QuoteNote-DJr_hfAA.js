import{o as R,j as e,B as d,T as L,U as se,x as ne,ah as re,J as G,ab as V,g as ie}from"./mui-5MYSBV5R.js";import{r as h}from"./reactVendor-BAhb8EbJ.js";import{u as D}from"./lang-BFcXlKUT.js";import{r as P,bl as le,bm as ce,a2 as de,aa as ue,bn as pe,a5 as S,bo as fe,aS as xe,i as he,u as I,bp as me,bg as ge,a as Y,a3 as be,p as je,R as ye,ah as M,bq as W}from"./react-setup-B89zJiq4.js";import"../index.CgW3dhwJ.js";import{q as we,m as Le}from"./QuoteStatus-okEafaTN.js";import{n as N}from"./eStyled-BQSmO2oX.js";import{n as K}from"./lodashEs-Ck10JMnh.js";var Q={},Ce=R;Object.defineProperty(Q,"__esModule",{value:!0});var X=Q.default=void 0,qe=Ce(P()),ve=e;X=Q.default=(0,qe.default)((0,ve.jsx)("path",{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}),"ExpandLess");var k={},Fe=R;Object.defineProperty(k,"__esModule",{value:!0});var Z=k.default=void 0,Se=Fe(P()),Ie=e;Z=k.default=(0,Se.default)((0,Ie.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore");function ee(o){const{children:u,title:t="",header:r,defaultOpen:i=!1,handleOnChange:s}=o,[p,m]=h.useState(i),g=()=>{m(!p)};return h.useEffect(()=>{s&&s(p)},[s,p]),h.useEffect(()=>{i&&m(i)},[i]),e.jsxs(d,{children:[e.jsxs(d,{onClick:g,sx:{display:"flex",justifyContent:"space-between",cursor:"pointer",alignItems:"center"},children:[r||e.jsx(L,{variant:"h5",children:t}),p?e.jsx(X,{}):e.jsx(Z,{})]}),e.jsx(se,{in:p,timeout:"auto",unmountOnExit:!0,children:u})]})}var O={},De=R;Object.defineProperty(O,"__esModule",{value:!0});var te=O.default=void 0,Ne=De(P()),Be=e;te=O.default=(0,Ne.default)((0,Be.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 17h-2v-2h2zm2.07-7.75-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25"}),"Help");const Ae=N(d)(({style:o})=>({"& .file-upload-area":{cursor:"pointer","& .MuiDropzoneArea-textContainer":{display:"flex",alignItems:"center",color:(o==null?void 0:o.color)||"#1976D2"},"& .MuiDropzoneArea-text":{order:1,textTransform:"uppercase",fontWeight:500,fontSize:"14px",lineHeight:"24px"}}})),Te=N(d)(o=>({display:"flex",background:o.hasdelete==="true"?"rgba(25, 118, 210, 0.3)":"rgba(0, 0, 0, 0.12)",borderRadius:"18px",padding:"6px 8px",alignItems:"center",margin:"0 0 2px",color:"rgba(0, 0, 0, 0.54)","& .fileList-name-area":{display:"flex",flex:1,alignItems:"center"},"& .fileList-name":{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden",flexGrow:1,flexBasis:"100px",maxWidth:"200px",color:"#313440",fontSize:"14px",cursor:"pointer"}})),Ue=N(L)({marginBottom:"16px",fontSize:"10px",color:"rgba(0, 0, 0, 0.38)",padding:"0 12px",textAlign:"right",wordBreak:"break-word"}),J=N(le)(()=>({transform:"rotate(45deg)",marginRight:"5px"}));function _e(o,u){const t=D(),{title:r=t("global.fileUpload.addAttachment"),tips:i=t("global.fileUpload.maxFileSizeMessage"),maxFileSize:s=2097152,fileNumber:p=3,limitUploadFn:m,acceptedFiles:g=ce,onchange:j=K,fileList:l=[],allowUpload:f=!0,onDelete:c=K,isEndLoadding:q=!1,requestType:B="quoteAttachedFile"}=o,T=ne().palette.primary.main,[U,n]=h.useState(!1);h.useImperativeHandle(u,()=>({setUploadLoadding:a=>n(a)}));const x=a=>a/1048576>1?"".concat((a/1048576).toFixed(1),"MB"):a/1024>1?"".concat((a/1024).toFixed(1),"KB"):"".concat(a,"B"),y=(a,w,A)=>{const{size:_,type:z}=a;let E=!1;w.forEach(oe=>{E=new RegExp(oe).test(z)||E});let F="";return E||(F=t("global.fileUpload.fileTypeNotSupported")),_>A&&(F=t("global.fileUpload.fileSizeExceedsLimit",{maxFileSize:x(A)})),F&&S.error(F),F},b=()=>(S.error(t("global.fileUpload.fileSizeExceedsLimit",{maxFileSize:x(s)})),""),C=async a=>{const w=a.length>0?a[0]:null;if(!(w&&m&&m())){if(!m&&w&&l.length>=p){S.error(t("global.fileUpload.maxFileNumber",{fileNumber:p}));return}if(w)try{n(!0);const{code:A,data:_,message:z}=await fe({file:w,type:B});A===200?j({..._,id:xe()}):S.error(z)}finally{q||n(!1)}}},v=a=>{c(a)},ae=a=>{a&&window.open(a,"_blank")};return e.jsx(de,{isSpinning:U,children:e.jsxs(d,{sx:{padding:"12px 0 0",width:"100%"},children:[e.jsx(d,{children:l.map((a,w)=>e.jsxs(d,{children:[e.jsxs(Te,{hasdelete:((a==null?void 0:a.hasDelete)||"").toString(),children:[e.jsxs(d,{className:"fileList-name-area",children:[e.jsx(J,{}),e.jsx(L,{className:"fileList-name",onClick:()=>{ae(a.fileUrl)},children:a.fileName})]}),a.hasDelete&&e.jsx(ue,{sx:{cursor:"pointer"},onClick:()=>{v((a==null?void 0:a.id)||"")}})]}),e.jsx(Ue,{children:a.title||""})]},a.id||w))}),f&&e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",marginTop:"10px"},children:[e.jsx(Ae,{style:{color:T},children:e.jsx(pe,{dropzoneClass:"file-upload-area",Icon:J,filesLimit:1,onChange:C,showPreviews:!1,showPreviewsInDropzone:!1,maxFileSize:s,showAlerts:!1,dropzoneText:r,getDropRejectMessage:y,getFileLimitExceedMessage:b,acceptedFiles:g})}),e.jsx(re,{title:i,sx:{fontSize:"20px",color:"rgba(0, 0, 0, 0.54)"},children:e.jsx(te,{})})]})]})})}const ze=h.forwardRef(_e);function Ge(o){const{allowUpload:u=!0,defaultFileList:t=[],status:r,quoteId:i}=o,s=D(),p=he(),m=I(({company:n})=>n.customer.firstName),g=I(({company:n})=>n.customer.lastName),j=I(({quoteInfo:n})=>n.draftQuoteInfo),[l]=me(),[f,c]=h.useState([]),q=h.useRef(null);h.useEffect(()=>{if(r===0){const{fileInfo:n=[]}=j||{};c(typeof n!="object"?[]:n)}else t.length&&c(t)},[t.length,r]);const B=n=>{if(j){const x={...j,fileInfo:n};p(ge(x))}},H=async n=>{var x;try{let y=[];if(r!==0){const b={fileName:n.fileName,fileType:n.fileType,fileUrl:n.fileUrl,fileSize:n.fileSize},{quoteAttachFileCreate:{attachFiles:C}}=await we({fileList:[{...b}],quoteId:i});b.id=C[0].id,y=[{...b,title:s("global.quoteAttachment.uploadedByCustomer",{createdBy:C[0].createdBy}),hasDelete:!0},...f]}else y=[{...n,title:s("global.quoteAttachment.uploadedByCustomerWithName",{firstName:m,lastName:g}),hasDelete:!0},...f],B(y);c(y)}finally{(x=q.current)==null||x.setUploadLoadding(!1)}},T=async n=>{var x,y;try{(x=q.current)==null||x.setUploadLoadding(!0);const b=f.find(v=>v.id===n),C=f.filter(v=>v.id!==n);r!==0&&b?await Le({fileId:(b==null?void 0:b.id)||"",quoteId:i}):B(C),c(C)}finally{(y=q.current)==null||y.setUploadLoadding(!1)}},U=()=>f.filter(x=>(x==null?void 0:x.title)&&x.title.includes("by customer")).length>=3?(S.error(s("global.quoteAttachment.maxFilesMessage")),!0):!1;return e.jsx(G,{children:e.jsx(V,{sx:{p:"16px !important"},children:e.jsx(ee,{title:s("global.quoteAttachment.title"),children:e.jsx(d,{children:e.jsx(ze,{ref:q,requestType:l!=="b2b"?"customerQuoteAttachedFile":"quoteAttachedFile",isEndLoadding:!0,fileList:f,limitUploadFn:U,onchange:H,onDelete:T,allowUpload:u})})})})})}const Ee=N("div")(({padding:o="1rem",alignItems:u="flex-start",flexDirection:t="row",backgroundColor:r="white",width:i="100%",xs:s})=>({display:"flex",flexDirection:t,alignItems:u,padding:o,width:i,backgroundColor:r,...s})),Me=["name","email","companyName","phoneNumber","quoteTitle"],$e=["label","firstName","lastName","company","address","apartment","city","state","zipCode","country","phoneNumber"],Re=["label",["firstName","lastName"],"company","address","apartment",["city","state","zipCode","country"],"phoneNumber"];function $({flag:o,title:u,info:t,status:r}){const i=o==="info"?Me:Re,[s]=Y(),p=D(),m=r==="Draft"?"Please add ".concat(o==="Billing"?"billing":"shipping"," address "):"No ".concat(o==="Billing"?"billing":"shipping"," address"),g=o!=="info"?$e.some(l=>t&&!!t[l]):!1,j=o==="info"||s?0:"10px";return e.jsxs(d,{sx:{width:s?"100%":"33.3%",paddingLeft:j},children:[e.jsx(L,{sx:{fontWeight:400,fontSize:"24px",height:"32px"},children:u}),e.jsxs(d,{sx:{p:"15px 0"},children:[(g||o==="info")&&JSON.stringify(t)!=="{}"&&i.map(l=>l==="quoteTitle"?r==="Draft"?e.jsx(L,{sx:{wordBreak:"break-all"},variant:"body1",children:"".concat(p("quoteDraft.quoteInfo.quoteTitle")).concat(t[l]||"")},l):"":typeof l=="string"?e.jsx(L,{variant:"body1",children:t&&t[l]||""},l):e.jsx(L,{variant:"body1",children:l.map((f,c)=>c===l.length-1?t[f]||"":f==="firstName"?"".concat(t[f]||""," "):t[f]?"".concat(t[f]||"",", "):"")},"".concat(l))),!g&&o!=="info"&&e.jsx(d,{children:m})]})]})}function Ve({contactInfo:o,shippingAddress:u,billingAddress:t,handleEditInfoClick:r,status:i}){const s=D(),[p]=Y();return e.jsxs(Ee,{flexDirection:"column",xs:{boxShadow:"0px 2px 1px -1px rgba(0, 0, 0, 0.2), 0px 1px 1px rgba(0, 0, 0, 0.14), 0px 1px 3px rgba(0, 0, 0, 0.12)",borderRadius:"4px"},children:[e.jsxs(d,{sx:{width:"100%",display:"flex",justifyContent:"space-between",flexDirection:p?"column":"row"},children:[e.jsx($,{title:s("quoteDraft.contactInfo.contact"),flag:"info",status:i,info:o}),e.jsx($,{title:s("global.quoteInfo.billing"),flag:"Billing",status:i,info:t}),e.jsx($,{title:s("global.quoteInfo.shipping"),flag:"Shipping",status:i,info:u})]}),r&&e.jsx(be,{sx:{mt:"10px",mb:"15px"},onClick:r,variant:"outlined",children:s("global.quoteInfo.editInfo")})]})}function Ye(o){const u=D(),{quoteStatus:t,quoteNotes:r=""}=o,[i,s]=h.useState(""),[p,m]=h.useState(!1),g=I(je),j=I(ye),l=g?j.quotesActionsPermission:!0,f=c=>{s((c==null?void 0:c.target.value)||""),M.dispatch(W((c==null?void 0:c.target.value)||""))};return h.useEffect(()=>{const c=M.getState().quoteInfo.draftQuoteInfo.note||"";s(c)},[]),h.useEffect(()=>{M.dispatch(W(i||""))},[i]),h.useEffect(()=>{r&&m(!0)},[r]),e.jsx(G,{children:e.jsx(V,{sx:{p:"16px !important"},children:e.jsx(ee,{title:u(t&&t==="Draft"?"global.quoteNote.message":"global.quoteNote.notes"),defaultOpen:p,children:e.jsxs(d,{sx:{padding:"16px 0"},children:[t&&t==="Draft"&&e.jsx(d,{sx:{fontSize:"16px",color:"rgba(0, 0, 0, 0.38)",mb:"16px"},children:u("global.quoteNote.messageNote")}),r?e.jsx(L,{variant:"body1",style:{whiteSpace:"pre-line",maxHeight:"400px",overflow:"auto"},children:r}):e.jsx(d,{children:l?e.jsx(ie,{multiline:!0,fullWidth:!0,rows:5,value:i,onChange:f,label:u("global.quoteNote.typeMessage"),size:"small",variant:"filled",sx:{"& .MuiFormLabel-root":{color:"rgba(0, 0, 0, 0.38)"}}}):null})]})})})})}export{ee as B,Ee as C,Ve as Q,Ye as a,Ge as b};
