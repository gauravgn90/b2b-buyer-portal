import{a9 as Jt,j as t,G as it,B as x,T as R,V as Yt,W as Zt,e as Xt,J as te,ab as wt,ae as vt,Z as ee,s as ft,g as Bt}from"./mui-5MYSBV5R.js";import{r as O}from"./reactVendor-BAhb8EbJ.js";import"../index.CgW3dhwJ.js";import{B as Et,G as se,u as $,aO as Qt,R as Vt,a as xt,an as jt,a3 as ht,a5 as g,aP as kt,aQ as yt,aJ as Pt,U as St,aR as Dt,aS as re,aE as Lt,aT as ne,aU as oe,aV as ie,aW as ae,aF as ce,aG as de,p as Ot,a2 as It,aX as ue,aH as le,aI as pe,aY as he,al as Ft,ac as fe,aZ as xe}from"./react-setup-B89zJiq4.js";import{u as lt}from"./lang-BFcXlKUT.js";import{i as me}from"./lodashEs-Ck10JMnh.js";import{b as bt}from"./b3Logger-CMQiGC3f.js";import{s as ut}from"./B3LinkTipContent-BVl82U0K.js";import{b as Ct}from"./b3TriggerCartNumber-BPwZgbsT.js";import ge from"./CreateShoppingList-1lVs3VDT.js";import ke from"./OrderShoppingList-B7KfrOGd.js";import{u as ye}from"./router-BbCjXwHs.js";import{b as Pe}from"./muiIcon-Du0m7JKT.js";import{S as Se,d as Ie}from"./SearchProduct-BiYUTf66.js";import{u as _t}from"./useBlockPendingAccountViewPrice-B1YyFb3K.js";import{u as be}from"./form-Bvi8lP6x.js";import{B as Ce}from"./B3CustomForm-DjrjSYXN.js";import{b as Mt}from"./b2bGetVariantImageByVariantInfo-BMNBG_0_.js";import{d as dt,B as je,a as Le}from"./B3FilterMore-D4S_BlgN.js";import{u as Oe}from"./useSort-Cu2YrCwH.js";import{B as qe}from"./B3FilterSearch-zd7_SPrR.js";import"./eReact-DeS39u1B.js";import"./intl-CIPMD0ue.js";import"./eCache-BQInSoPa.js";import"./eStyled-BQSmO2oX.js";import"./redux-B-shcavw.js";import"./toolkit-CHPG993j.js";import"./dateFns-CE3kB2v1.js";import"./dropzone-CHkuoC7V.js";import"./useCustomCallbacks-D2SU_LXI.js";import"./b3ShoppingList-B11xUer0.js";const Rt=(k,l,Q)=>{const c=k.find(L=>+L.variant_id===l||Q===L.sku)||{};return me(c)?!1:+c.bc_calculated_price.tax_inclusive},$t=k=>'{\n  orderedProducts (\n    q: "'.concat(k.q||"",'"\n    first: ').concat(k.first,"\n    offset: ").concat(k.offset,'\n    beginDateAt: "').concat(k.beginDateAt,'"\n    endDateAt: "').concat(k.endDateAt,'"\n    orderBy: "').concat((k==null?void 0:k.orderBy)||"",'"\n  ){\n    totalCount,\n    pageInfo{\n      hasNextPage,\n      hasPreviousPage,\n    },\n    edges{\n      node {\n        id,\n        createdAt,\n        updatedAt,\n        productName,\n        productBrandName,\n        variantSku,\n        productId,\n        variantId,\n        optionList,\n        orderedTimes,\n        firstOrderedAt,\n        lastOrderedAt,\n        lastOrderedItems,\n        sku,\n        lastOrdered,\n        imageUrl,\n        baseSku,\n        basePrice,\n        discount,\n        tax,\n        enteredInclusive,\n        productUrl,\n        optionSelections,\n      }\n    }\n  }\n}'),ve=k=>Et.graphqlB2B({query:$t(k)}),Ae=k=>Et.graphqlB2B({query:$t(k)});function Te(k){const{checkedArr:l,isAgenting:Q,setIsRequestLoading:c,isB2BUser:L}=k,{state:{productQuoteEnabled:D=!1,shoppingListEnabled:F=!1}}=O.useContext(se),d=lt(),w=$(n=>n.company.companyInfo.id),{currency_code:G}=$(Qt),{purchasabilityPermission:st}=$(Vt),K=L?st:!0,H=Jt("(min-width:1775px)"),[y]=xt(),U=O.useRef(null),[A,J]=O.useState(!1),[N,rt]=O.useState(0),[at,Y]=O.useState(!1),[tt,W]=O.useState(!1),[nt,h]=O.useState(!1),I=$(n=>n.company.customer.customerGroupId),V=ye(),e=y?{alignItems:"flex-start",flexDirection:"column"}:{alignItems:"center"},o=()=>{l.length===0?g.error(d("purchasedProducts.error.selectOneItem")):J(!0)},i=()=>{J(!1)},p=n=>{const j=[];return l.forEach(C=>{const{node:q}=C,B=n.find(S=>+q.productId===S.id);if(B){const{variants:S}=B;if(S.length>0){const E=S.find(v=>q.variantSku===v.sku&&+q.variantId==+v.variant_id);if(E){const{optionList:v,quantity:ot}=q,z=v.map(_=>({optionId:_.product_option_id,optionValue:_.value}));j.push({optionSelections:z,allOptions:v,productId:parseInt(E.product_id,10)||0,quantity:ot,variantId:parseInt(E.variant_id,10)||0})}}}}),j},s=async()=>{c(!0),i();try{const n=[];if(l.forEach(E=>{const{node:v}=E;n.includes(+v.productId)||n.push(+v.productId)}),n.length===0){g.error(d("purchasedProducts.footer.selectOneItemToAdd"));return}const j=w,C=L?kt:yt,{productsSearch:q}=await C({productIds:n,companyId:j,customerGroupId:I}),B=p(q||[]),S=await Pt(B);S&&!S.errors?g.success("",{jsx:ut({message:d("purchasedProducts.footer.productsAdded"),link:St,linkText:d("purchasedProducts.footer.viewCart"),isOutLink:!0,isCustomEvent:!0}),isClose:!0}):S&&S.errors?g.error(S.errors[0].message,{isClose:!0}):g.error("Error has occurred",{isClose:!0})}finally{Ct(),c(!1)}},a=n=>(n==null?void 0:n.length)===0?[]:n.map(({product_option_id:C,value:q})=>({optionId:"attribute[".concat(C,"]"),optionValue:q})),r=async()=>{c(!0),i();try{const n=l.filter(_=>{const{node:{variantSku:M}}=_;return M!==""&&M!==null&&M!==void 0}),j=l.filter(_=>{const{node:{variantSku:M}}=_;return!M});if(j.length>0&&g.error(d("purchasedProducts.footer.cantAddProductsNoSku"),{isClose:!0}),j.length===l.length)return;const C=[];n.forEach(_=>{const{node:M}=_;C.includes(+M.productId)||C.push(+M.productId)});const q=L?kt:yt,{productsSearch:B}=await q({productIds:C,companyId:w,customerGroupId:I,currencyCode:G}),S=Dt(B);let E=!1,v="",ot=!0;const z=[];if(n.forEach(_=>{const{node:{basePrice:M,optionList:Ut,variantSku:mt,productId:qt,productName:zt,quantity:Nt,variantId:Gt,tax:Wt}}=_,Kt=a(Ut),pt=S.find(gt=>+gt.id==+qt),ct=pt==null?void 0:pt.variants.find(gt=>gt.sku===mt);ct||(v=d("purchasedProducts.footer.notFoundSku",{sku:mt}),ot=!1);const Ht={node:{id:re(),variantSku:(ct==null?void 0:ct.sku)||mt,variantId:Gt,productsSearch:pt,primaryImage:(ct==null?void 0:ct.image_url)||Lt,productName:zt,quantity:+Nt||1,optionList:JSON.stringify(Kt),productId:qt,basePrice:M,tax:Wt}};z.push(Ht),E=!0}),E=ne(z),!ot){g.error("",{jsx:ut({message:v,link:"",linkText:"",isOutLink:!1}),isClose:!0});return}E?(await oe(z,"2"),ie(z),g.success("",{jsx:ut({message:d("purchasedProducts.footer.productsAddedToQuote"),link:"/quoteDraft",linkText:d("purchasedProducts.footer.viewQuote"),isOutLink:!1}),isClose:!0})):g.error("",{jsx:ut({message:d("purchasedProducts.footer.productsLimit"),link:"/quoteDraft",linkText:d("purchasedProducts.footer.viewQuote"),isOutLink:!1}),isClose:!0})}catch(n){bt.error(n)}finally{c(!1)}},u=n=>{V("/shoppingList/".concat(n))},m=n=>t.jsxs(x,{sx:{display:"flex",alignItems:"center"},children:[t.jsx(x,{sx:{mr:"15px"},children:d("purchasedProducts.footer.productsAddedToShoppingList")}),t.jsx(Xt,{onClick:()=>u(n),variant:"text",sx:{color:"#ffffff",padding:0},children:"view shopping list"})]}),f=n=>{Y(!1),W(!1)},P=()=>{Y(!1),W(!0)},b=()=>{W(!1),Y(!0)},Z=()=>{i(),b(),Y(!0)},T=async n=>{h(!0);try{const j=[];l.forEach(B=>{const{node:S}=B;j.includes(+S.productId)||j.push(+S.productId)});const C=[];l.forEach(B=>{const{node:{optionList:S,productId:E,quantity:v,variantId:ot,productsSearch:z}}=B,_=a(S),M=ae(_,z);C.push({productId:+E,variantId:+ot,quantity:+v,optionList:M})}),await(L?ce:de)({shoppingListId:+n,items:C}),g.success(d("purchasedProducts.footer.productsAddedToShoppingList"),{jsx:()=>m(n),isClose:!0}),f(!0)}catch(j){bt.error(j)}finally{h(!1)}},X=[{name:d("purchasedProducts.footer.addToCart"),key:"add-selected-to-cart",handleClick:s,isDisabled:!K},{name:d("purchasedProducts.footer.addToQuote"),key:"add-selected-to-quote",handleClick:r,isDisabled:!D},{name:d("purchasedProducts.footer.addSelectedProductsToShoppingList"),key:"add-selected-to-shoppingList",handleClick:Z,isDisabled:!F}];O.useEffect(()=>{if(l.length>0){let n=0;l.forEach(j=>{const{node:{variantId:C,productsSearch:{variants:q},quantity:B,basePrice:S}}=j;if(q!=null&&q.length){const E=Rt(q,+C)||+S;n+=E*+B}else n+=+S*+B}),rt(1e3*n/1e3)}else rt(0)},[l]);let et={display:y?"initial":"flex",flexBasis:"100%"};return H&&(et={display:"flex",flexGrow:1,maxWidth:1775,margin:"auto"}),t.jsxs(t.Fragment,{children:[K||D||F?t.jsx(it,{sx:{position:"fixed",bottom:y&&Q?"52px":0,left:0,backgroundColor:"#fff",width:"100%",padding:y?"0 0 1rem 0":"16px 0 16px",height:y?"8rem":"auto",marginLeft:0,display:"flex",flexWrap:"nowrap",zIndex:"1000"},container:!0,spacing:2,children:t.jsxs(it,{item:y,sx:et,children:[t.jsx(x,{sx:{width:263,display:y?"none":"block"}}),t.jsxs(x,{sx:{flex:1,display:"flex",alignItems:"center",paddingLeft:y?0:"50px",paddingRight:y?0:"80px"},children:[t.jsxs(x,{sx:{width:y?"100%":"calc(66.6667% + 32px)",display:"flex",zIndex:"999",justifyContent:"space-between",...e},children:[t.jsx(R,{sx:{color:"#000000",fontSize:"16px",fontWeight:"400"},children:d("purchasedProducts.footer.selectedProducts",{quantity:l.length})}),t.jsxs(x,{sx:{display:"flex",alignItems:"center",flexWrap:y?"wrap":"nowrap",width:y?"100%":"auto"},children:[t.jsx(R,{variant:"h6",sx:{fontSize:"16px",fontWeight:"700",color:"#000000"},children:d("purchasedProducts.footer.subtotal",{subtotal:jt(N)})}),t.jsxs(x,{sx:{display:"flex",alignItems:"center",marginTop:y?"0.5rem":0,marginLeft:y?0:"20px",width:y?"100%":"auto"},children:[t.jsx(ht,{variant:"contained",ref:U,onClick:o,sx:{marginRight:y?"1rem":0,width:y?"100%":"auto"},endIcon:t.jsx(Pe,{}),children:d("purchasedProducts.footer.addSelectedTo")}),t.jsx(Yt,{id:"basic-menu",anchorEl:U.current,open:A,onClose:i,MenuListProps:{"aria-labelledby":"basic-button"},children:X.length>0&&X.map(n=>n.isDisabled?null:t.jsx(Zt,{onClick:()=>{n.handleClick()},children:n.name},n.key))})]})]})]}),t.jsx(x,{sx:{width:"33.3333%",display:y?"none":"block"}})]})]})}):null,t.jsx(ke,{isOpen:at,dialogTitle:d("purchasedProducts.footer.addToShoppingList"),onClose:f,onConfirm:T,onCreate:P,isLoading:nt,setLoading:h}),t.jsx(ge,{open:tt,onChange:Z,onClose:b})]})}function we(k){const l=lt(),{updateList:Q=()=>{},quickAddToList:c,level:L=3,buttonText:D=l("purchasedProducts.quickAdd.addProductToList")}=k,F=$(Ot),d=$(({company:s})=>s.companyInfo.status),[w,G]=O.useState(L),[st,K]=O.useState([]),[H,y]=O.useState(!1),U=(s,a)=>{new Array(s).fill(1).forEach((r,u)=>a(u))};O.useEffect(()=>{let s=[];U(w,a=>{s=[...s,...ue(a,l)]}),K(s)},[w]);const[A]=_t(),J=()=>{G(w+L)},{control:N,handleSubmit:rt,getValues:at,formState:{errors:Y},setError:tt,setValue:W}=be({mode:"all"}),nt=(s,a,r)=>{if(!a&&!r)return!0;let u=!0;const m=parseInt(r,10)||0;return a||(tt("sku-".concat(s),{type:"manual",message:l("global.validate.required",{label:l("purchasedProducts.quickAdd.sku")})}),u=!1),r?m<=0&&(tt("qty-".concat(s),{type:"manual",message:"incorrect number"}),u=!1):(tt("qty-".concat(s),{type:"manual",message:l("global.validate.required",{label:l("purchasedProducts.quickAdd.qty")})}),u=!1),u},h=s=>{const a={};let r=!0;return U(w,u=>{const m=s["sku-".concat(u)],f=s["qty-".concat(u)];if(r=nt(u,m,f)===!1?!1:r,r&&m){const P=parseInt(f,10)||0;a[m]=a[m]?a[m]+P:P}}),{skuValue:a,isValid:r,skus:Object.keys(a)}},I=(s,a,r)=>{const u=[],m=[],f=[],P=[],b=[],Z=[];return r.forEach(T=>{const X=(s||[]).find(z=>z.variantSku.toUpperCase()===T.toUpperCase());if(!X){u.push(T);return}const{productId:et,variantId:n,option:j,purchasingDisabled:C="1",stock:q,isStock:B,maxQuantity:S,minQuantity:E}=X,v=a[T]||0;if(C==="1"){m.push(T);return}if(B==="1"&&v>+q){b.push({sku:T,stock:+q});return}if(S!==0&&E!==0&&v>0&&(v>S||v<E)){Z.push({sku:T,min:v<E?E:0,max:v>S?S:0});return}const ot=(j||[]).reduce((z,_)=>{try{const M=typeof _=="string"?JSON.parse(_):_;return z.push({optionId:"attribute[".concat(M.option_id,"]"),optionValue:"".concat(M.id)}),z}catch(M){return z}},[]);P.push(T),f.push({...X,newSelectOptionList:ot,productId:parseInt(et,10)||0,quantity:v,variantId:parseInt(n,10)||0})}),{notFoundSku:u,notPurchaseSku:m,notStockSku:b,productItems:f,passSku:P,orderLimitSku:Z}},V=(s,a,r,u)=>{a.forEach(m=>{const f=Object.keys(s).find(P=>s[P]===m)||"";f&&tt(f.replace("sku",r),{type:"manual",message:u})})},e=(s,a)=>{a.forEach(r=>{const u=Object.keys(s).find(m=>s[m]===r)||"";u&&(W(u,""),W(u.replace("sku","qty"),""))})},o=async s=>{const a=F?le:pe;try{const{variantSku:r}=await a({skus:s},!0);return r}catch(r){return[]}},i=()=>{if(A&&d===0){g.info("Your business account is pending approval. This feature is currently disabled.");return}rt(async s=>{try{y(!0);const{skuValue:a,isValid:r,skus:u}=h(s);if(!r||u.length<=0)return;const m=await o(u),{notFoundSku:f,notPurchaseSku:P,productItems:b,passSku:Z,notStockSku:T,orderLimitSku:X}=I(m,a,u);if(f.length>0&&(V(s,f,"sku",""),g.error(l("purchasedProducts.quickAdd.notFoundSku",{notFoundSku:f.join(",")}),{isClose:!0})),P.length>0&&(V(s,P,"sku",""),g.error(l("purchasedProducts.quickAdd.notPurchaseableSku",{notPurchaseSku:P.join(",")}),{isClose:!0})),T.length>0){const et=T.map(n=>n.sku);T.forEach(n=>{const{sku:j,stock:C}=n;V(s,[j],"qty","".concat(C," in stock"))}),g.error(l("purchasedProducts.quickAdd.insufficientStockSku",{stockSku:et.join(",")}),{isClose:!0})}X.length>0&&X.forEach(et=>{const{min:n,max:j,sku:C}=et,q=n===0?"Max":"Min",B=n===0?j:n;V(s,[C],"qty","".concat(q," is ").concat(B));const S=n===0?"maximum":"minimum";g.error(l("purchasedProducts.quickAdd.purchaseQuantityLimitMessage",{typeText:S,limit:B,sku:C}),{isClose:!0})}),b.length>0&&(await c(b),e(s,Z),Q())}finally{y(!1)}})()},p=s=>{s.key==="Enter"&&i()};return t.jsx(It,{isSpinning:H,spinningHeight:"auto",children:t.jsxs(x,{sx:{width:"100%"},children:[t.jsxs(it,{container:!0,sx:{margin:"16px 0"},children:[t.jsx(it,{item:!0,sx:{flex:1,display:"flex",alignItems:"center"},children:t.jsx(R,{sx:{color:"#000"},variant:"body1",children:l("purchasedProducts.quickAdd.title")})}),t.jsx(it,{item:!0,children:t.jsx(ht,{variant:"text",sx:{textTransform:"initial",ml:"-8px"},onClick:J,children:l("purchasedProducts.quickAdd.showMoreRowsButton")})})]}),t.jsx(x,{onKeyDown:p,sx:{"& label":{zIndex:0}},children:t.jsx(Ce,{formFields:st,errors:Y,control:N,getValues:at,setValue:W})}),t.jsx(ht,{variant:"outlined",fullWidth:!0,disabled:H,onClick:i,sx:{margin:"20px 0"},children:t.jsx(It,{isSpinning:H,tip:"",size:16,children:t.jsx(x,{sx:{flex:1,textAlign:"center"},children:D})})})]})})}function Be(k){const{isB2BUser:l}=k,[Q]=xt(),c=lt(),[L,D]=O.useState(!1),[F,d]=O.useState([]),[w,G]=O.useState("Add to cart"),[st,K]=O.useState(!1),[H]=_t(),y=$(({company:h})=>h.companyInfo.status),U=$(({global:h})=>h.blockPendingQuoteNonPurchasableOOS.isEnableProduct),A=h=>{h&&!h.errors?g.success("",{jsx:ut({message:c("purchasedProducts.quickOrderPad.productsAdded"),link:St,linkText:c("purchasedProducts.quickOrderPad.viewCart"),isOutLink:!0,isCustomEvent:!0}),isClose:!0}):g.error("Error has occurred",{isClose:!0})},J=async h=>{const I=await Pt(h);return I&&I.errors?g.error(I.errors[0].message,{isClose:!0}):g.success("",{jsx:ut({message:c("purchasedProducts.quickOrderPad.productsAdded"),link:St,linkText:c("purchasedProducts.quickOrderPad.viewCart"),isOutLink:!0,isCustomEvent:!0}),isClose:!0}),Ct(),I},N=h=>t.jsxs(t.Fragment,{children:[t.jsx("p",{style:{margin:0},children:c("purchasedProducts.quickOrderPad.notEnoughStock",{variantSku:h.variantSku})}),t.jsx("p",{style:{margin:0},children:c("purchasedProducts.quickOrderPad.availableAmount",{availableAmount:h.AvailableAmount})})]}),rt=(h,I)=>t.jsxs(t.Fragment,{children:[t.jsx("p",{style:{margin:0},children:c("purchasedProducts.quickOrderPad.outOfStockSku",{outOfStock:h.join(",")})}),t.jsx(ee,{href:I,sx:{color:"#FFFFFF"},children:c("purchasedProducts.quickOrderPad.downloadErrorsCSV")})]}),at=h=>{const I=[],V=[],e=[],o=[],i=[],p=[];return h.forEach(s=>{const{products:a,qty:r}=s,{option:u,isStock:m,stock:f,purchasingDisabled:P,maxQuantity:b,minQuantity:Z,variantSku:T,variantId:X,productId:et,modifiers:n}=a;if(P==="1"||P){I.push(T);return}if(m==="1"&&f===0){p.push(T);return}if(m==="1"&&f>0&&f<+r){e.push({variantSku:T,AvailableAmount:f});return}if(+Z>0&&+r<+Z){o.push({variantSku:T,minQuantity:Z});return}if(+b>0&&+r>+b){i.push({variantSku:T,maxQuantity:b});return}const j=u.map(C=>({optionId:C.option_id,optionValue:C.id}));V.push({productId:parseInt(et,10)||0,variantId:parseInt(X,10)||0,quantity:+r,optionSelections:j,allOptions:n})}),{notPurchaseSku:I,productItems:V,limitProduct:e,minLimitQuantity:o,maxLimitQuantity:i,outOfStock:p}},Y=async h=>{K(!0);try{const{stockErrorFile:I,validProduct:V}=h,{notPurchaseSku:e,productItems:o,limitProduct:i,minLimitQuantity:p,maxLimitQuantity:s,outOfStock:a}=at(V);if(o.length>0){const r=await Pt(o);A(r),Ct()}i.length>0&&i.forEach(r=>{g.warning("",{jsx:()=>N(r)})}),e.length>0&&g.error(c("purchasedProducts.quickOrderPad.notPurchaseableSku",{notPurchaseSku:e.join(",")}),{isClose:!0}),a.length>0&&I&&g.error("",{jsx:()=>rt(a,I),isClose:!0}),p.length>0&&p.forEach(r=>{g.error(c("purchasedProducts.quickOrderPad.minQuantityMessage",{minQuantity:r.minQuantity,sku:r.variantSku}),{isClose:!0})}),s.length>0&&s.forEach(r=>{g.error(c("purchasedProducts.quickOrderPad.maxQuantityMessage",{maxQuantity:r.maxQuantity,sku:r.variantSku}),{isClose:!0})}),D(!1)}finally{K(!1)}},tt=h=>{const{variantId:I,variants:V,inventoryLevel:e,inventoryTracking:o,orderQuantityMaximum:i,orderQuantityMinimum:p,quantity:s,sku:a}=h,r=o!=="none";let u=!1,m=e,f=a;const P=V.find(b=>+b.variant_id==+I);return P&&(u=P.purchasing_disabled,m=o==="variant"?P.inventory_level:m,f=P.sku||a),u&&!U?(g.error(c("purchasedProducts.quickOrderPad.notPurchaseableSku",{notPurchaseSku:f})),!1):r&&+s>+m?(g.error(c("purchasedProducts.quickOrderPad.insufficientStockSku",{sku:f}),{isClose:!0}),!1):+p>0&&+s<p?(g.error(c("purchasedProducts.quickOrderPad.minQuantityMessage",{minQuantity:p,sku:f}),{isClose:!0}),!1):+i>0&&+s>+i?(g.error(c("purchasedProducts.quickOrderPad.maxQuantityMessage",{maxQuantity:i,sku:f}),{isClose:!0}),!1):!0},W=async h=>{const I=h[0],V=tt(I);try{V&&await J(h)}catch(e){bt.error(e)}return h},nt=()=>{H&&y===0?g.info(c("purchasedProducts.quickOrderPad.addNProductsToCart")):D(!0)};return O.useEffect(()=>{(F==null?void 0:F.length)>0&&G(c("purchasedProducts.quickOrderPad.addNProductsToCart",{quantity:F.length}))},[F]),t.jsxs(te,{sx:{marginBottom:Q?"8.5rem":"50px"},children:[t.jsx(wt,{children:t.jsxs(x,{children:[t.jsx(R,{variant:"h5",sx:{marginBottom:"1rem"},children:c("purchasedProducts.quickOrderPad.quickOrderPad")}),t.jsx(Se,{addToList:W,searchDialogTitle:c("purchasedProducts.quickOrderPad.quickOrderPad"),type:"quickOrder",addButtonText:c("purchasedProducts.quickOrderPad.addToCart"),isB2BUser:l}),t.jsx(vt,{}),t.jsx(we,{quickAddToList:J,buttonText:c("purchasedProducts.quickOrderPad.addProductsToCart")}),t.jsx(vt,{}),t.jsx(x,{sx:{margin:"20px 0 0"},children:t.jsxs(ht,{variant:"text",onClick:()=>nt(),children:[t.jsx(Ie,{sx:{marginRight:"8px"}}),c("purchasedProducts.quickOrderPad.bulkUploadCSV")]})})]})}),t.jsx(he,{isOpen:L,setIsOpen:D,handleAddToList:Y,setProductData:d,addBtnText:w,isLoading:st,isToCart:!0})]})}const Ee=ft("img")(()=>({maxWidth:"60px",height:"auto",marginRight:"0.5rem"}));function Qe(k){const{item:l,checkBox:Q,handleUpdateProductQty:c}=k,L=lt(),{quantity:D,imageUrl:F,productName:d,variantSku:w,optionList:G,basePrice:st,lastOrderedAt:K,variantId:H,productsSearch:y}=l,U=+st*+D,A=y.variants||[],J=Mt(A,{variantId:H})||F;return t.jsx(x,{sx:{borderTop:"1px solid #D9DCE9"},children:t.jsxs(wt,{sx:{color:"#313440",display:"flex",pl:0},children:[t.jsx(x,{children:Q&&Q()}),t.jsx(x,{children:t.jsx(Ee,{src:J||Lt,alt:"Product-img",loading:"lazy"})}),t.jsxs(x,{sx:{flex:1},children:[t.jsx(R,{variant:"body1",color:"#212121",children:d}),t.jsx(R,{variant:"body1",color:"#616161",children:w}),t.jsx(x,{sx:{margin:"1rem 0"},children:G.length>0&&t.jsx(x,{children:G.map(N=>t.jsx(R,{sx:{fontSize:"0.75rem",lineHeight:"1.5",color:"#455A64"},children:"".concat(N.display_name,": ").concat(N.display_value)},N.display_name))})}),t.jsx(R,{sx:{fontSize:"14px"},children:L("purchasedProducts.quickOrderCard.price",{price:jt(U)})}),t.jsx(x,{sx:{"& label":{zIndex:0}},children:t.jsx(Bt,{size:"small",type:"number",variant:"filled",label:"Qty",inputProps:{inputMode:"numeric",pattern:"[0-9]*"},value:D,sx:{margin:"1rem 0",width:"60%",maxWidth:"100px","& label":{fontSize:"14px"},"& input":{fontSize:"14px"}},onChange:N=>{c(l.id,N.target.value)}})}),t.jsx(R,{sx:{fontSize:"14px"},children:L("purchasedProducts.quickOrderCard.lastOrdered",{lastOrderedAt:Ft(K)})})]})]})},l.id)}const Ve=ft("img")(()=>({maxWidth:"60px",height:"auto",marginRight:"0.5rem"})),De=ft(x)(()=>({display:"flex",flexDirection:"column",width:"100%","& tbody":{"& tr":{"& td":{verticalAlign:"top"},"& td: first-of-type":{paddingTop:"25px"}}}})),Fe=ft(Bt)(()=>({"& input":{paddingTop:"12px",paddingRight:"6px"}})),At="lastOrderedAt",Tt={product:"productName",lastOrderedAt:"lastOrderedAt"};function _e({setIsRequestLoading:k,setCheckedArr:l,isRequestLoading:Q}){const c=O.useRef(null),L=$(Ot),D=$(({company:e})=>e.companyInfo.id),F=$(({company:e})=>e.customer.customerGroupId),[d,w]=O.useState({q:"",beginDateAt:dt(90),endDateAt:dt(0),orderBy:"-".concat(Tt[At])}),[G,st,K]=Oe(Tt,At,d,w),[H,y]=O.useState(0),[U]=xt(),A=lt(),{currency_code:J}=$(Qt),N=async e=>{if(e.length>0){const o=[];e.forEach(p=>{const{node:s}=p;s.quantity=1,o.includes(s.productId)||o.push(s.productId)});const i=L?kt:yt;try{const{productsSearch:p}=await i({productIds:o,currencyCode:J,companyId:D,customerGroupId:F}),s=Dt(p);return e.forEach(a=>{const{node:r}=a,u=s.find(m=>{const{id:f}=m;return+r.productId==+f});r.productsSearch=u||{}}),e}catch(p){g.error(p)}}return[]},rt=async e=>{const{orderedProducts:{edges:o,totalCount:i}}=L?await ve(e):await Ae(e),p=await N(o);return y(i),{edges:p,totalCount:i}},at=async e=>{w({...d,q:e})},Y=e=>{var o;if(e.length>0){const i=((o=c.current)==null?void 0:o.getCacheList())||[],p=e.map(s=>i.find(r=>{const{node:u}=r;return u.id===s}));l([...p])}else l([])},tt=(e,o)=>{const i={...d};e==="start"?i.beginDateAt=o||dt(90):i.endDateAt=o||dt(0),w(i)},W=e=>{const o={...d};o.beginDateAt=e.startValue,o.endDateAt=e.endValue,w(o)},nt=(e,o)=>{var r,u,m,f;if(o!==""&&+o<=0)return;const i=((r=c.current)==null?void 0:r.getList())||[],p=((u=c.current)==null?void 0:u.getCacheList())||[],s=i==null?void 0:i.map(P=>{const{node:b}=P;return(b==null?void 0:b.id)===e&&(b.quantity=+o||""),P}),a=p==null?void 0:p.map(P=>{const{node:b}=P;return(b==null?void 0:b.id)===e&&(b.quantity=+o||""),P});(m=c.current)==null||m.setList([...s]),(f=c.current)==null||f.setCacheAllList([...a])},h=(e,o)=>{const{productsSearch:{isPriceHidden:i}}=o;return i?"":xe({price:e,productInfo:o,showText:i?"":e,forcedSkip:!0})},I=e=>{var p;const o=((p=c.current)==null?void 0:p.getCacheList())||[];let i=e.quantity;if(o.length>0){const s=o.find(a=>a.node.variantId===e.variantId&&a.node.productId===e.productId&&a.node.id===e.id);s&&s.node&&(i=s.node.quantity||i)}return i},V=[{key:"product",title:A("purchasedProducts.product"),render:e=>{const{optionList:o,productsSearch:i,variantId:p}=e,s=i.variants||[],a=Mt(s,{variantId:p})||e.imageUrl;return t.jsxs(x,{sx:{display:"flex",alignItems:"flex-start"},children:[t.jsx(Ve,{src:a||Lt,alt:"Product-img",loading:"lazy"}),t.jsxs(x,{children:[t.jsx(R,{variant:"body1",color:"#212121",children:e.productName}),t.jsx(R,{variant:"body1",color:"#616161",children:e.variantSku}),o.length>0&&t.jsx(x,{children:o.map(r=>t.jsx(R,{sx:{fontSize:"0.75rem",lineHeight:"1.5",color:"#455A64"},children:"".concat(r.display_name,": ").concat(r.display_value)},r.id))})]})]})},width:"40%",isSortable:!0},{key:"price",title:A("purchasedProducts.price"),render:e=>{const{productsSearch:{variants:o},variantId:i,basePrice:p}=e;let s=+p;o!=null&&o.length&&(s=Rt(o,+i)||+p);const a=I(e),u=(s||+p)*+a;return t.jsx(R,{sx:{padding:"12px 0"},children:"".concat(h(jt(u),e))})},width:"15%",style:{textAlign:"right"}},{key:"qty",title:A("purchasedProducts.qty"),render:e=>{const o=I(e);return t.jsx(Fe,{size:"small",type:"number",variant:"filled",value:o,inputProps:{inputMode:"numeric",pattern:"[0-9]*"},onChange:i=>{nt(e.id,i.target.value)}})},width:"15%",style:{textAlign:"right"}},{key:"lastOrderedAt",title:A("purchasedProducts.lastOrdered"),render:e=>t.jsx(x,{children:t.jsx(R,{sx:{padding:"12px 0"},children:"".concat(Ft(+e.lastOrderedAt))})}),width:"15%",style:{textAlign:"right"},isSortable:!0}];return t.jsx(It,{isSpinning:Q,children:t.jsxs(De,{children:[t.jsx(R,{sx:{fontSize:"24px",height:"50px"},children:A("purchasedProducts.totalProducts",{total:H})}),t.jsxs(x,{sx:{marginBottom:"5px",display:"flex","& label":{zIndex:0}},children:[t.jsxs(x,{sx:{width:U?"100%":"40%",mr:"20px",display:"flex",justifyContent:U?"space-between":"flex-start"},children:[t.jsx(qe,{h:"48px",searchBGColor:"rgba(0, 0, 0, 0.06)",handleChange:e=>{at(e)}}),U&&t.jsx(x,{sx:{display:"flex",alignItems:"center"},children:t.jsx(je,{fiterMoreInfo:[],startPicker:{isEnabled:!0,label:A("purchasedProducts.from"),defaultValue:(d==null?void 0:d.beginDateAt)||"",pickerKey:"start"},endPicker:{isEnabled:!0,label:A("purchasedProducts.to"),defaultValue:(d==null?void 0:d.endDateAt)||"",pickerKey:"end"},isShowMore:!0,onChange:W})})]}),!U&&t.jsx(Le,{handleChange:tt,xs:{mt:0,height:"50px"},startPicker:{isEnabled:!0,label:A("purchasedProducts.from"),defaultValue:dt(90),pickerKey:"start"},endPicker:{isEnabled:!0,label:A("purchasedProducts.to"),defaultValue:dt(),pickerKey:"end"},customWidth:"58%"})]}),t.jsx(fe,{ref:c,columnItems:V,rowsPerPageOptions:[12,24,36],getRequestList:rt,searchParams:d,isCustomRender:!1,showCheckbox:!0,showSelectAllCheckbox:!0,disableCheckbox:!1,hover:!0,labelRowsPerPage:A("purchasedProducts.itemsPerPage"),showBorder:!1,requestLoading:k,getSelectCheckbox:Y,itemIsMobileSpacing:0,isSelectOtherPageCheckbox:!0,noDataText:A("purchasedProducts.noProductsFound"),sortDirection:st,orderBy:K,sortByFn:G,renderItem:(e,o,i)=>t.jsx(Qe,{item:e,checkBox:i,handleUpdateProductQty:nt})})]})})}function gs(){const k=$(Ot),l=$(({b2bFeatures:G})=>G.masqueradeCompany.isAgenting),[Q]=xt(),[c,L]=O.useState(!1),[D,F]=O.useState([]),{purchasabilityPermission:d}=$(Vt),w=k?d:!0;return t.jsxs(x,{sx:{width:"100%"},children:[t.jsx(x,{sx:{display:"flex",justifyContent:"center"},children:t.jsxs(it,{sx:{m:0,width:"100%"},container:!0,spacing:2,children:[t.jsx(it,{item:!0,xs:Q?12:8,sx:{backgroundColor:"#ffffff",boxShadow:"0px 2px 1px -1px rgba(0, 0, 0, 0.2), 0px 1px 1px rgba(0, 0, 0, 0.14), 0px 1px 3px rgba(0, 0, 0, 0.12)",borderRadius:"4px",pr:"16px"},children:t.jsx(_e,{setCheckedArr:F,setIsRequestLoading:L,isRequestLoading:c})}),t.jsx(it,{item:!0,xs:Q?12:4,sx:{pt:Q?"16px":"0px !important",pl:Q?"0px !important":"16px"},children:w&&t.jsx(Be,{isB2BUser:k})})]})}),t.jsx(x,{sx:{position:"fixed",bottom:0,left:0,width:"100%",zIndex:"999"},children:t.jsx(Te,{checkedArr:D,isAgenting:l,setIsRequestLoading:L,isB2BUser:k})})]})}export{gs as default};
