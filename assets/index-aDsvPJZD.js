import{j as e,B as n,x as J,T as xe,$ as E,a3 as fe}from"./mui-5MYSBV5R.js";import{r as w}from"./reactVendor-BAhb8EbJ.js";import{u as he,d as be}from"./router-BbCjXwHs.js";import{u as _}from"./lang-BFcXlKUT.js";import{B as we}from"./B3Card-DexeMvwR.js";import{a3 as N,k as ye,a as z,i as G,u as I,as as Ce,G as Te,C as Le,at as je,a2 as Ie,n as Be,o as Se,a5 as U,au as Fe,av as Pe,aw as Ae,ax as Re,a8 as ke,a6 as ve,w as He,ah as De,ay as Me,az as qe,x as Ee,aA as O,ab as W,aB as Ue,aC as Oe}from"./react-setup-B89zJiq4.js";import{b as We}from"./b3Logger-CMQiGC3f.js";import"../index.CgW3dhwJ.js";import{l as Je}from"./b3Login-1VB9S_e7.js";import{b as _e,a as Ne}from"./login-BJsXd5Gr.js";import{a as ze,l as Ge}from"./config-Dwx2MMve.js";import{u as Ve}from"./form-Bvi8lP6x.js";import{B as Qe}from"./B3CustomForm-DjrjSYXN.js";import{a as Ye,L as $e}from"./styled-Bgd6vsVD.js";import"./eReact-DeS39u1B.js";import"./intl-CIPMD0ue.js";import"./eCache-BQInSoPa.js";import"./eStyled-BQSmO2oX.js";import"./redux-B-shcavw.js";import"./toolkit-CHPG993j.js";import"./lodashEs-Ck10JMnh.js";import"./muiIcon-Du0m7JKT.js";import"./dateFns-CE3kB2v1.js";import"./dropzone-CHkuoC7V.js";import"./validatorRules-CTaxO-S2.js";function k(a){const{html:l,sx:c}=a;return e.jsx(n,{sx:{...c},dangerouslySetInnerHTML:{__html:l}})}function Ke(a){const{loginBtn:l,handleLoginSubmit:c,gotoForgotPassword:f,backgroundColor:m}=a,d=_(),g=J(),{control:S,handleSubmit:p,getValues:s,formState:{errors:F},setValue:P}=Ve({mode:"onSubmit"}),y=h=>{c(h)},T=ze(d,p(y));return e.jsxs(n,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx(xe,{variant:"h5",sx:{margin:"20px 0",display:"flex",justifyContent:"center",alignItems:"center"},children:d("login.loginText.signInHeader")}),e.jsx(n,{sx:{width:"100%","& input":{bgcolor:"#F5F5F5",borderRadius:"4px",borderBottomLeftRadius:"0",borderBottomRightRadius:"0"}},children:e.jsxs("form",{onSubmit:p(y),children:[e.jsx(Qe,{formFields:T,errors:F,control:S,getValues:s,setValue:P}),e.jsxs(n,{sx:{display:"flex",justifyContent:"flex-start ",alignItems:"center",mt:2},children:[e.jsx(N,{type:"submit",variant:"contained",sx:{backgroundColor:g.palette.primary.main},children:l}),e.jsx(n,{sx:{cursor:"pointer",ml:2,textDecoration:"underline",textUnderlineOffset:"4px",color:ye(m)},onClick:()=>f(),children:d("login.loginText.forgotPasswordText")})]})]})})]})}function Xe(a){const{handleSubmit:l,widgetBodyText:c,createAccountButtonText:f}=a,m=J(),[d]=z();return e.jsxs(n,{sx:{padding:d?"16px":"20px",borderRadius:"4px",mt:d?"0":"-25px"},children:[e.jsx(k,{sx:{minHeight:"250px","& .panel":{".panel-title":{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",fontWeight:400,fontSize:"24px"}}},html:c}),e.jsx(n,{sx:{marginTop:"5px"},children:e.jsx(N,{type:"submit",onClick:l,variant:"contained",sx:{ml:d?0:1,backgroundColor:m.palette.primary.main},children:f})})]})}const Ze=()=>{const a=I(({b2bFeatures:g})=>g.masqueradeCompany.isAgenting),l=I(({company:g})=>g.customer.b2bId),c=I(({b2bFeatures:g})=>g.masqueradeCompany.id),f=G(),m=a&&typeof l=="number";return{endMasquerade:w.useCallback(async()=>{m&&(await Be(+c,l),f(Se()))},[l,m,c,f]),isMasquerade:m}},et=a=>{if(a)switch(a){case"1":return"error";case"4":return"error";case"5":return"warning";default:return"success"}};function St(a){const{isMasquerade:l,endMasquerade:c}=Ze(),{setOpenPage:f}=a,m=G(),d=I(Ce),g=I(({quoteInfo:i})=>i.quoteDetailToCheckoutUrl),[S,p]=w.useState(!0),[s]=z(),[F,P]=w.useState(!0),[y,T]=w.useState(""),[h,V]=w.useState({emailAddress:"",password:""}),C=he(),o=_(),[A,Q]=be(),{state:{isCheckout:Y,logo:$,registerEnabled:L}}=w.useContext(Te),{state:{loginPageButton:v,loginPageDisplay:K,loginPageHtml:X,portalStyle:{backgroundColor:Z="FEF9F5"}}}=w.useContext(Le),{createAccountButtonText:ee,primaryButtonColor:te,signInButtonText:oe}=v;console.log(v);const{displayStoreLogo:ne,pageTitle:se}=K,{bottomHtmlRegionEnabled:ie,bottomHtmlRegionHtml:re,createAccountPanelHtml:ae,topHtmlRegionEnabled:le,topHtmlRegionHtml:ce}=X,u={loginTitle:se||o("login.button.signIn"),loginBtn:oe||o("login.button.signInUppercase"),createAccountButtonText:ee||o("login.button.createAccount"),btnColor:te||"",widgetHeadText:le?ce:void 0,widgetBodyText:ae||je,widgetFooterText:ie?re:void 0,logo:ne?$:void 0};w.useEffect(()=>{(async()=>{var r;try{const b=A.get("loginFlag"),R=A.get("showTip")!=="false";if(P(R),b&&T(b),b==="7"&&U.error(o("login.loginText.invoiceErrorTip")),b==="3"&&d){const B=await Fe();if((r=B.data.site.cart)!=null&&r.entityId){const t=Pe(B.data.site.cart.entityId);await Ae(t)}const{result:x}=(await _e()).data.logout;if(x!=="success")return;l&&await c(),window.sessionStorage.clear(),Re(),p(!1),window.location.reload();return}p(!1)}finally{p(!1)}})()},[o,c,d,l,A]);const H=(i,r="")=>{if(!i)return"";switch(i){case"1":return o("login.loginTipInfo.resetPassword",{email:r});case"2":return o("login.loginTipInfo.receivePassword");case"3":return o("login.loginTipInfo.loggedOutLogin");case"4":return o("login.loginTipInfo.accountincorrect");case"5":return o("login.loginTipInfo.accountPrelaunch");case"6":return o("login.loginText.deviceCrowdingLogIn");default:return""}},D=async i=>{const r=await Oe(i);T(r?"1":"4")},de=async i=>{if(p(!0),V(i),Q(r=>(r.delete("loginFlag"),r)),Y)try{await Ge(i),window.location.reload()}catch(r){We.error(r),D(i.emailAddress)}else try{const r={email:i.emailAddress,password:i.password,storeHash:ke,channelId:ve},{login:{result:{token:b,storefrontLoginToken:R,permissions:B},errors:x}}=await Ne({loginData:r});if(m(He(b)),De.dispatch(Me(B)),qe(R),x!=null&&x[0]||!b){if(x!=null&&x[0]){const{message:t}=x[0];if(t==="Operation cannot be performed as the storefront channel is not live"){T("5"),p(!1);return}}D(i.emailAddress)}else{const t=await Ee(b);if(g){C(g);return}if((t==null?void 0:t.userType)===O.MULTIPLE_B2C&&(t==null?void 0:t.role)===W.SUPER_ADMIN){C("/dashboard");return}if(!Je(C))return;const{getShoppingListPermission:M,getOrderPermission:q}=Ue();if((t==null?void 0:t.role)===W.JUNIOR_BUYER&&(t==null?void 0:t.companyRoleName)==="Junior Buyer")C(M?"/shoppingLists":"/accountSettings");else{let j=q?"/orders":"/shoppingLists";j=M||q?j:"/accountSettings",j=(t==null?void 0:t.userType)===O.B2C?"/orders":j,C(j)}}}catch(r){U.error(o("login.loginTipInfo.accountincorrect"))}finally{p(!1)}},ge=()=>{C("/register")},ue=()=>{C("/forgotpassword")},me=L?"100%":"50%",pe=L?"50%":"auto";return e.jsx(we,{setOpenPage:f,children:e.jsx(Ye,{paddings:s?"0":"20px 20px",children:e.jsx(Ie,{isSpinning:S,tip:o("global.tips.loading"),background:"transparent",children:e.jsx(n,{sx:{display:"flex",flexDirection:"column",width:"100%",minHeight:"400px",minWidth:"343px"},children:u&&e.jsxs(e.Fragment,{children:[y&&F&&e.jsx(n,{sx:{padding:s?0:"0 5%",margin:"30px 0 0 0"},children:H(y,h==null?void 0:h.emailAddress)&&e.jsx(E,{severity:et(y),variant:"filled",children:H(y,(h==null?void 0:h.emailAddress)||"")})}),g&&e.jsx(E,{severity:"error",variant:"filled",children:o("login.loginText.quoteDetailToCheckoutUrl")}),u.logo&&e.jsx(n,{sx:{margin:"20px 0",minHeight:"150px"},children:e.jsx($e,{children:e.jsx(fe,{sx:{maxWidth:s?"70%":"250px"},onClick:()=>{window.location.href="/"},children:e.jsx("img",{src:u.logo,alt:o("login.registerLogo"),loading:"lazy"})})})}),u.widgetHeadText&&e.jsx(k,{sx:{minHeight:"48px",width:L||s?"100%":"50%"},html:u.widgetHeadText}),e.jsx(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},children:e.jsx(n,{sx:{bgcolor:"#FFFFFF",borderRadius:"4px",margin:"20px 0",display:"flex",flexDirection:"column",justifyContent:"center",width:s?"auto":me},children:e.jsxs(n,{sx:{mb:"20px",display:"flex",flexDirection:s?"column":"row",justifyContent:"center",width:s?"auto":"100%"},children:[e.jsx(n,{sx:{width:s?"auto":pe,paddingRight:s?0:"2%",ml:"16px",mr:s?"16px":"",pb:L?"":"36px"},children:e.jsx(Ke,{loginBtn:u.loginBtn,gotoForgotPassword:ue,handleLoginSubmit:de,backgroundColor:Z})}),L&&e.jsx(n,{sx:{flex:"1",paddingLeft:s?0:"2%"},children:e.jsx(Xe,{createAccountButtonText:u.createAccountButtonText,widgetBodyText:u.widgetBodyText,handleSubmit:ge})})]})})}),u.widgetFooterText&&e.jsx(k,{sx:{minHeight:"48px",width:L||s?"100%":"50%"},html:u.widgetFooterText})]})})})})})}export{St as default};
